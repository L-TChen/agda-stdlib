<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.Golden</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Golden testing framework</a>
<a id="134" class="Comment">------------------------------------------------------------------------</a>

<a id="208" class="Comment">-- This is a port of the golden testing framework used by the Idris2</a>
<a id="277" class="Comment">-- compiler and various Idris2 libraries.</a>
<a id="319" class="Comment">-- It provides the core features required to perform golden file testing.</a>
<a id="393" class="Comment">--</a>
<a id="396" class="Comment">-- We provide the core functionality to run a *single* golden file test,</a>
<a id="469" class="Comment">-- or a whole test tree. This allows the developer freedom to use as is</a>
<a id="541" class="Comment">-- or design the rest of the test harness to their liking.</a>

<a id="601" class="Comment">------------------------------------------------------------------------</a>
<a id="674" class="Comment">-- Test Structure</a>
<a id="692" class="Comment">--</a>
<a id="695" class="Comment">-- This harness works from the assumption that each individual golden</a>
<a id="765" class="Comment">-- test comprises of a directory with the following structure:</a>
<a id="828" class="Comment">--</a>
<a id="831" class="Comment">-- + `run` a *shell* script that runs the test. We expect it to:</a>
<a id="896" class="Comment">--   * Use `$1` as the variable standing for the Agda executable to be tested</a>
<a id="974" class="Comment">--   * Clean up after itself (e.g. by running `rm -rf build/`)</a>
<a id="1037" class="Comment">--</a>
<a id="1040" class="Comment">-- + `expected` a file containting the expected output of `run`</a>
<a id="1104" class="Comment">--</a>
<a id="1107" class="Comment">-- During testing, the test harness will generate an `output` file.</a>
<a id="1175" class="Comment">-- It will be compared to the `expected` golden file provided by the user.</a>
<a id="1250" class="Comment">-- In case there is a mismatch, the framework will:</a>

<a id="1303" class="Comment">-- + either display output &amp; expected if the session is not interactive</a>
<a id="1375" class="Comment">-- + or use the following command line to produce a diff and ask the user</a>
<a id="1449" class="Comment">--   whether they want to overwrite the currently `expected` value:</a>
<a id="1517" class="Comment">--</a>
<a id="1520" class="Comment">--  git diff --no-index --exit-code --word-diff=color expected output</a>
<a id="1590" class="Comment">--</a>
<a id="1593" class="Comment">-- If `git` fails then the runner will simply present the expected and</a>
<a id="1664" class="Comment">-- &#39;given&#39; files side-by-side.</a>
<a id="1695" class="Comment">--</a>
<a id="1698" class="Comment">-- Of note, it is helpful to add `output` to a local `.gitignore` instance</a>
<a id="1773" class="Comment">-- to ensure that it is not mistakenly versioned.</a>


<a id="1825" class="Comment">------------------------------------------------------------------------</a>
<a id="1898" class="Comment">-- Options</a>
<a id="1909" class="Comment">--</a>
<a id="1912" class="Comment">-- The test harness has several options that may be set:</a>
<a id="1969" class="Comment">--</a>
<a id="1972" class="Comment">-- + `exeUnderTest` The path of the executable we are testing (typically `agda`)</a>
<a id="2053" class="Comment">-- + `onlyNames`    The tests to run relative to the generated executable.</a>
<a id="2128" class="Comment">-- + `onlyFile`     The file listing the tests to run relative to the generated executable.</a>
<a id="2220" class="Comment">-- + `interactive`  Whether to offer to update the expected file or not.</a>
<a id="2293" class="Comment">-- + `timing`       Whether to display time taken for each test.</a>
<a id="2358" class="Comment">-- + `failureFile`  The file in which to write the list of failing tests.</a>
<a id="2432" class="Comment">-- + `colour`       The output should use ANSI escape codes</a>
<a id="2492" class="Comment">--</a>
<a id="2495" class="Comment">-- We provide an options parser (`options`) that takes the list of command line</a>
<a id="2575" class="Comment">-- arguments and constructs this for you.</a>
<a id="2617" class="Comment">---</a>

<a id="2622" class="Comment">------------------------------------------------------------------------</a>
<a id="2695" class="Comment">-- Usage</a>
<a id="2704" class="Comment">--</a>
<a id="2707" class="Comment">-- When compiled to an executable the expected usage is:</a>
<a id="2764" class="Comment">--</a>
<a id="2767" class="Comment">--```sh</a>
<a id="2775" class="Comment">--runtests &lt;path to executable under test&gt;</a>
<a id="2818" class="Comment">--   [--timing]</a>
<a id="2834" class="Comment">--   [--interactive]</a>
<a id="2855" class="Comment">--   [--only-file PATH]</a>
<a id="2879" class="Comment">--   [--failure-file PATH]</a>
<a id="2906" class="Comment">--   [--no-colour]</a>
<a id="2925" class="Comment">--   [--only [NAMES]]</a>
<a id="2947" class="Comment">--```</a>
<a id="2953" class="Comment">--</a>
<a id="2956" class="Comment">-- assuming that the test runner is compiled to an executable named `runtests`.</a>

<a id="3037" class="Symbol">{-#</a> <a id="3041" class="Keyword">OPTIONS</a> <a id="3049" class="Pragma">--cubical-compatible</a> <a id="3070" class="Pragma">--guardedness</a> <a id="3084" class="Symbol">#-}</a>

<a id="3089" class="Keyword">module</a> <a id="3096" href="Test.Golden.html" class="Module">Test.Golden</a> <a id="3108" class="Keyword">where</a>

<a id="3115" class="Keyword">open</a> <a id="3120" class="Keyword">import</a> <a id="3127" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="3142" class="Keyword">using</a> <a id="3148" class="Symbol">(</a><a id="3149" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a><a id="3153" class="Symbol">;</a> <a id="3155" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="3159" class="Symbol">;</a> <a id="3161" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a><a id="3166" class="Symbol">;</a> <a id="3168" href="Data.Bool.Base.html#1292" class="Function Operator">if_then_else_</a><a id="3181" class="Symbol">)</a>
<a id="3183" class="Keyword">import</a> <a id="3190" href="Data.Char.html" class="Module">Data.Char</a> <a id="3200" class="Symbol">as</a> <a id="3203" class="Module">Char</a>
<a id="3208" class="Keyword">open</a> <a id="3213" class="Keyword">import</a> <a id="3220" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="3229" class="Keyword">using</a> <a id="3235" class="Symbol">(</a><a id="3236" href="Data.Fin.html#739" class="Function Operator">#_</a><a id="3238" class="Symbol">)</a>
<a id="3240" class="Keyword">import</a> <a id="3247" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a> <a id="3265" class="Symbol">as</a> <a id="3268" class="Module">ℤ</a>
<a id="3270" class="Keyword">open</a> <a id="3275" class="Keyword">import</a> <a id="3282" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="3297" class="Symbol">as</a> <a id="3300" class="Module">List</a> <a id="3305" class="Keyword">using</a> <a id="3311" class="Symbol">(</a><a id="3312" href="Agda.Builtin.List.html#130" class="Datatype">List</a><a id="3316" class="Symbol">;</a> <a id="3318" href="Data.List.Base.html#7370" class="InductiveConstructor">[]</a><a id="3320" class="Symbol">;</a> <a id="3322" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">_∷_</a><a id="3325" class="Symbol">;</a> <a id="3327" href="Data.List.Base.html#1938" class="Function Operator">_++_</a><a id="3331" class="Symbol">;</a> <a id="3333" href="Data.List.Base.html#11412" class="Function">filter</a><a id="3339" class="Symbol">;</a> <a id="3341" href="Data.List.Base.html#3888" class="Function">partitionSums</a><a id="3354" class="Symbol">)</a>
<a id="3356" class="Keyword">open</a> <a id="3361" class="Keyword">import</a> <a id="3368" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html" class="Module">Data.List.Relation.Binary.Infix.Heterogeneous.Properties</a> <a id="3425" class="Keyword">using</a> <a id="3431" class="Symbol">(</a><a id="3432" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6659" class="Function">infix?</a><a id="3438" class="Symbol">)</a>
<a id="3440" class="Keyword">open</a> <a id="3445" class="Keyword">import</a> <a id="3452" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="3481" class="Keyword">using</a> <a id="3487" class="Symbol">(</a><a id="3488" href="Data.List.Relation.Unary.Any.html#2660" class="Function">any?</a><a id="3492" class="Symbol">)</a>
<a id="3494" class="Keyword">open</a> <a id="3499" class="Keyword">import</a> <a id="3506" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="3522" class="Keyword">using</a> <a id="3528" class="Symbol">(</a><a id="3529" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a><a id="3534" class="Symbol">;</a> <a id="3536" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a><a id="3540" class="Symbol">;</a> <a id="3542" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="3549" class="Symbol">;</a> <a id="3551" href="Data.Maybe.Base.html#1656" class="Function">fromMaybe</a><a id="3560" class="Symbol">)</a>
<a id="3562" class="Keyword">open</a> <a id="3567" class="Keyword">import</a> <a id="3574" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="3588" class="Keyword">using</a> <a id="3594" class="Symbol">(</a><a id="3595" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a><a id="3596" class="Symbol">;</a> <a id="3598" href="Data.Nat.Base.html#1136" class="Primitive Operator">_≡ᵇ_</a><a id="3602" class="Symbol">;</a> <a id="3604" href="Data.Nat.Base.html#1310" class="Primitive Operator">_&lt;ᵇ_</a><a id="3608" class="Symbol">;</a> <a id="3610" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">_+_</a><a id="3613" class="Symbol">;</a> <a id="3615" href="Data.Nat.Base.html#3211" class="Primitive Operator">_∸_</a><a id="3618" class="Symbol">)</a>
<a id="3620" class="Keyword">import</a> <a id="3627" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a> <a id="3641" class="Symbol">as</a> <a id="3644" class="Module">ℕ</a>
<a id="3646" class="Keyword">open</a> <a id="3651" class="Keyword">import</a> <a id="3658" href="Data.Product.html" class="Module">Data.Product</a> <a id="3671" class="Keyword">using</a> <a id="3677" class="Symbol">(</a><a id="3678" href="Data.Product.Base.html#1118" class="Function Operator">_×_</a><a id="3681" class="Symbol">;</a> <a id="3683" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">_,_</a><a id="3686" class="Symbol">)</a>
<a id="3688" class="Keyword">open</a> <a id="3693" class="Keyword">import</a> <a id="3700" href="Data.String.html" class="Module">Data.String</a> <a id="3712" class="Symbol">as</a> <a id="3715" class="Module">String</a> <a id="3722" class="Keyword">using</a> <a id="3728" class="Symbol">(</a><a id="3729" href="Agda.Builtin.String.html#318" class="Postulate">String</a><a id="3735" class="Symbol">;</a> <a id="3737" href="Data.String.Base.html#5107" class="Function">lines</a><a id="3742" class="Symbol">;</a> <a id="3744" href="Data.String.Base.html#2824" class="Function">unlines</a><a id="3751" class="Symbol">;</a> <a id="3753" href="Data.String.Base.html#2766" class="Function">unwords</a><a id="3760" class="Symbol">;</a> <a id="3762" href="Data.String.Base.html#2611" class="Function">concat</a><a id="3768" class="Symbol">;</a> <a id="3770" href="Data.String.Properties.html#2294" class="Function Operator">_≟_</a><a id="3773" class="Symbol">)</a>
<a id="3775" class="Keyword">open</a> <a id="3780" class="Keyword">import</a> <a id="3787" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="3801" class="Keyword">using</a> <a id="3807" class="Symbol">(</a><a id="3808" href="Data.Sum.Base.html#625" class="Datatype Operator">_⊎_</a><a id="3811" class="Symbol">;</a> <a id="3813" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a><a id="3817" class="Symbol">;</a> <a id="3819" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a><a id="3823" class="Symbol">)</a>
<a id="3825" class="Keyword">open</a> <a id="3830" class="Keyword">import</a> <a id="3837" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="3852" class="Keyword">using</a> <a id="3858" class="Symbol">(</a><a id="3859" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a><a id="3860" class="Symbol">)</a>

<a id="3863" class="Keyword">open</a> <a id="3868" class="Keyword">import</a> <a id="3875" href="Function.Base.html" class="Module">Function.Base</a> <a id="3889" class="Keyword">using</a> <a id="3895" class="Symbol">(</a><a id="3896" href="Function.Base.html#704" class="Function">id</a><a id="3898" class="Symbol">;</a> <a id="3900" href="Function.Base.html#2003" class="Function Operator">_$_</a><a id="3903" class="Symbol">;</a> <a id="3905" href="Function.Base.html#4062" class="Function Operator">case_of_</a><a id="3913" class="Symbol">)</a>

<a id="3916" class="Keyword">open</a> <a id="3921" class="Keyword">import</a> <a id="3928" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="3955" class="Keyword">using</a> <a id="3961" class="Symbol">(</a><a id="3962" href="Relation.Nullary.Decidable.Core.html#1555" class="Field">does</a><a id="3966" class="Symbol">)</a>

<a id="3969" class="Keyword">open</a> <a id="3974" class="Keyword">import</a> <a id="3981" href="Codata.Musical.Notation.html" class="Module">Codata.Musical.Notation</a> <a id="4005" class="Keyword">using</a> <a id="4011" class="Symbol">(</a><a id="4012" href="Agda.Builtin.Coinduction.html#212" class="CoinductiveConstructor Operator">♯_</a><a id="4014" class="Symbol">)</a>
<a id="4016" class="Keyword">open</a> <a id="4021" class="Keyword">import</a> <a id="4028" href="IO.html" class="Module">IO</a>

<a id="4032" class="Keyword">open</a> <a id="4037" class="Keyword">import</a> <a id="4044" href="System.Clock.html" class="Module">System.Clock</a> <a id="4057" class="Symbol">as</a> <a id="4060" class="Module">Clock</a> <a id="4066" class="Keyword">using</a> <a id="4072" class="Symbol">(</a><a id="4073" href="System.Clock.html#2764" class="Function">time′</a><a id="4078" class="Symbol">;</a> <a id="4080" href="System.Clock.html#1919" class="Record">Time</a><a id="4084" class="Symbol">;</a> <a id="4086" href="System.Clock.html#1965" class="Field">seconds</a><a id="4093" class="Symbol">)</a>
<a id="4095" class="Keyword">open</a> <a id="4100" class="Keyword">import</a> <a id="4107" href="System.Console.ANSI.html" class="Module">System.Console.ANSI</a>
<a id="4127" class="Keyword">open</a> <a id="4132" class="Keyword">import</a> <a id="4139" href="System.Directory.html" class="Module">System.Directory</a> <a id="4156" class="Keyword">using</a> <a id="4162" class="Symbol">(</a><a id="4163" href="System.Directory.html#3050" class="Function">doesFileExist</a><a id="4176" class="Symbol">;</a> <a id="4178" href="System.Directory.html#3102" class="Function">doesDirectoryExist</a><a id="4196" class="Symbol">)</a>
<a id="4198" class="Keyword">open</a> <a id="4203" class="Keyword">import</a> <a id="4210" href="System.Environment.html" class="Module">System.Environment</a> <a id="4229" class="Keyword">using</a> <a id="4235" class="Symbol">(</a><a id="4236" href="System.Environment.html#655" class="Function">getArgs</a><a id="4243" class="Symbol">;</a> <a id="4245" href="System.Environment.html#772" class="Function">lookupEnv</a><a id="4254" class="Symbol">)</a>
<a id="4256" class="Keyword">open</a> <a id="4261" class="Keyword">import</a> <a id="4268" href="System.Exit.html" class="Module">System.Exit</a>
<a id="4280" class="Keyword">open</a> <a id="4285" class="Keyword">import</a> <a id="4292" href="System.FilePath.Posix.html" class="Module">System.FilePath.Posix</a> <a id="4314" class="Keyword">using</a> <a id="4320" class="Symbol">(</a><a id="4321" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a><a id="4331" class="Symbol">)</a>
<a id="4333" class="Keyword">open</a> <a id="4338" class="Keyword">import</a> <a id="4345" href="System.Process.html" class="Module">System.Process</a> <a id="4360" class="Keyword">using</a> <a id="4366" class="Symbol">(</a><a id="4367" href="System.Process.html#649" class="Function">callCommand</a><a id="4378" class="Symbol">;</a> <a id="4380" href="System.Process.html#729" class="Function">system</a><a id="4386" class="Symbol">)</a>

<a id="4389" class="Keyword">record</a> <a id="Options"></a><a id="4396" href="Test.Golden.html#4396" class="Record">Options</a> <a id="4404" class="Symbol">:</a> <a id="4406" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4410" class="Keyword">where</a>
  <a id="4418" class="Keyword">field</a>
    <a id="4428" class="Comment">-- What is the name of the Agda executable?</a>
    <a id="Options.exeUnderTest"></a><a id="4476" href="Test.Golden.html#4476" class="Field">exeUnderTest</a> <a id="4489" class="Symbol">:</a> <a id="4491" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="4502" class="Comment">-- Should we only run some specific cases?</a>
    <a id="Options.onlyNames"></a><a id="4549" href="Test.Golden.html#4549" class="Field">onlyNames</a> <a id="4559" class="Symbol">:</a> <a id="4561" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="4566" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="4577" class="Comment">-- Should we run the test suite interactively?</a>
    <a id="Options.interactive"></a><a id="4628" href="Test.Golden.html#4628" class="Field">interactive</a> <a id="4640" class="Symbol">:</a> <a id="4642" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="4651" class="Comment">-- Should we time and display the tests?</a>
    <a id="Options.timing"></a><a id="4696" href="Test.Golden.html#4696" class="Field">timing</a> <a id="4703" class="Symbol">:</a> <a id="4705" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="4714" class="Comment">-- Should we write the list of failing cases to a file?</a>
    <a id="Options.failureFile"></a><a id="4774" href="Test.Golden.html#4774" class="Field">failureFile</a> <a id="4786" class="Symbol">:</a> <a id="4788" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4794" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="4805" class="Comment">-- Should we use ANSI escape codes to colour the output?</a>
    <a id="Options.colour"></a><a id="4866" href="Test.Golden.html#4866" class="Field">colour</a> <a id="4873" class="Symbol">:</a> <a id="4875" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
<a id="4880" class="Keyword">open</a> <a id="4885" href="Test.Golden.html#4396" class="Module">Options</a>

<a id="initOptions"></a><a id="4894" href="Test.Golden.html#4894" class="Function">initOptions</a> <a id="4906" class="Symbol">:</a> <a id="4908" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="4915" class="Symbol">→</a> <a id="4917" href="Test.Golden.html#4396" class="Record">Options</a>
<a id="4925" href="Test.Golden.html#4894" class="Function">initOptions</a> <a id="4937" href="Test.Golden.html#4937" class="Bound">exe</a> <a id="4941" class="Symbol">=</a> <a id="4943" class="Keyword">record</a>
  <a id="4952" class="Symbol">{</a> <a id="4954" href="Test.Golden.html#4476" class="Field">exeUnderTest</a> <a id="4967" class="Symbol">=</a> <a id="4969" href="Test.Golden.html#4937" class="Bound">exe</a>
  <a id="4975" class="Symbol">;</a> <a id="4977" href="Test.Golden.html#4549" class="Field">onlyNames</a>    <a id="4990" class="Symbol">=</a> <a id="4992" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
  <a id="4997" class="Symbol">;</a> <a id="4999" href="Test.Golden.html#4628" class="Field">interactive</a>  <a id="5012" class="Symbol">=</a> <a id="5014" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
  <a id="5022" class="Symbol">;</a> <a id="5024" href="Test.Golden.html#4696" class="Field">timing</a>       <a id="5037" class="Symbol">=</a> <a id="5039" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
  <a id="5047" class="Symbol">;</a> <a id="5049" href="Test.Golden.html#4774" class="Field">failureFile</a>  <a id="5062" class="Symbol">=</a> <a id="5064" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
  <a id="5074" class="Symbol">;</a> <a id="5076" href="Test.Golden.html#4866" class="Field">colour</a>       <a id="5089" class="Symbol">=</a> <a id="5091" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
  <a id="5098" class="Symbol">}</a>

<a id="usage"></a><a id="5101" href="Test.Golden.html#5101" class="Function">usage</a> <a id="5107" class="Symbol">:</a> <a id="5109" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="5116" href="Test.Golden.html#5101" class="Function">usage</a> <a id="5122" class="Symbol">=</a> <a id="5124" href="Data.String.Base.html#2766" class="Function">unwords</a>
  <a id="5134" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="5136" class="String">&quot;Usage:&quot;</a>
  <a id="5147" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5149" class="String">&quot;runtests &lt;path&gt;&quot;</a>
  <a id="5169" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5171" class="String">&quot;[--timing]&quot;</a>
  <a id="5186" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5188" class="String">&quot;[--interactive]&quot;</a>
  <a id="5208" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5210" class="String">&quot;[--failure-file PATH]&quot;</a>
  <a id="5236" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5238" class="String">&quot;[--only-file PATH]&quot;</a>
  <a id="5261" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5263" class="String">&quot;[--no-colour]&quot;</a>
  <a id="5281" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5283" class="String">&quot;[--only [NAMES]]&quot;</a>
  <a id="5304" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5306" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

<a id="5310" class="Keyword">data</a> <a id="Error"></a><a id="5315" href="Test.Golden.html#5315" class="Datatype">Error</a> <a id="5321" class="Symbol">:</a> <a id="5323" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="5327" class="Keyword">where</a>
  <a id="Error.MissingExecutable"></a><a id="5335" href="Test.Golden.html#5335" class="InductiveConstructor">MissingExecutable</a> <a id="5353" class="Symbol">:</a> <a id="5355" href="Test.Golden.html#5315" class="Datatype">Error</a>
  <a id="Error.InvalidArgument"></a><a id="5363" href="Test.Golden.html#5363" class="InductiveConstructor">InvalidArgument</a> <a id="5379" class="Symbol">:</a> <a id="5381" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5388" class="Symbol">→</a> <a id="5390" href="Test.Golden.html#5315" class="Datatype">Error</a>

<a id="show"></a><a id="5397" href="Test.Golden.html#5397" class="Function">show</a> <a id="5402" class="Symbol">:</a> <a id="5404" href="Test.Golden.html#5315" class="Datatype">Error</a> <a id="5410" class="Symbol">→</a> <a id="5412" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="5419" href="Test.Golden.html#5397" class="Function">show</a> <a id="5424" href="Test.Golden.html#5335" class="InductiveConstructor">MissingExecutable</a> <a id="5442" class="Symbol">=</a> <a id="5444" class="String">&quot;Expected a path to Agda, got nothing&quot;</a>
<a id="5483" href="Test.Golden.html#5397" class="Function">show</a> <a id="5488" class="Symbol">(</a><a id="5489" href="Test.Golden.html#5363" class="InductiveConstructor">InvalidArgument</a> <a id="5505" href="Test.Golden.html#5505" class="Bound">arg</a><a id="5508" class="Symbol">)</a> <a id="5510" class="Symbol">=</a> <a id="5512" class="String">&quot;Invalid argument: &quot;</a> <a id="5533" href="Data.String.Base.html#2423" class="Function Operator">String.++</a> <a id="5543" href="Test.Golden.html#5505" class="Bound">arg</a>

<a id="5548" class="Comment">-- Process the command line options</a>
<a id="options"></a><a id="5584" href="Test.Golden.html#5584" class="Function">options</a> <a id="5592" class="Symbol">:</a> <a id="5594" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5599" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5606" class="Symbol">→</a> <a id="5608" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="5611" class="Symbol">(</a><a id="5612" href="Test.Golden.html#5315" class="Datatype">Error</a> <a id="5618" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5620" href="Test.Golden.html#4396" class="Record">Options</a><a id="5627" class="Symbol">)</a>
<a id="5629" href="Test.Golden.html#5584" class="Function">options</a><a id="5636" class="Symbol">(</a><a id="5637" href="Test.Golden.html#5637" class="Bound">exe</a> <a id="5641" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5643" href="Test.Golden.html#5643" class="Bound">rest</a><a id="5647" class="Symbol">)</a> <a id="5649" class="Symbol">=</a> <a id="5651" href="Test.Golden.html#6452" class="Function">mkOptions</a> <a id="5661" href="Test.Golden.html#5637" class="Bound">exe</a> <a id="5665" href="Test.Golden.html#5643" class="Bound">rest</a> <a id="5670" class="Keyword">where</a>

  <a id="5679" href="Test.Golden.html#5679" class="Function">go</a> <a id="5682" class="Symbol">:</a> <a id="5684" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5689" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5696" class="Symbol">→</a> <a id="5698" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5704" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5711" class="Symbol">→</a> <a id="5713" href="Test.Golden.html#4396" class="Record">Options</a> <a id="5721" class="Symbol">→</a> <a id="5723" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5730" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5732" class="Symbol">(</a><a id="5733" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5739" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5746" href="Data.Product.Base.html#1118" class="Function Operator">×</a> <a id="5748" href="Test.Golden.html#4396" class="Record">Options</a><a id="5755" class="Symbol">)</a>
  <a id="5759" href="Test.Golden.html#5679" class="Function">go</a> <a id="5762" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>                             <a id="5793" href="Test.Golden.html#5793" class="Bound">mfp</a> <a id="5797" href="Test.Golden.html#5797" class="Bound">opts</a> <a id="5802" class="Symbol">=</a> <a id="5804" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="5809" class="Symbol">(</a><a id="5810" href="Test.Golden.html#5793" class="Bound">mfp</a> <a id="5814" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5816" href="Test.Golden.html#5797" class="Bound">opts</a><a id="5820" class="Symbol">)</a>
  <a id="5824" href="Test.Golden.html#5679" class="Function">go</a> <a id="5827" class="Symbol">(</a><a id="5828" class="String">&quot;--timing&quot;</a>            <a id="5850" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5852" href="Test.Golden.html#5852" class="Bound">args</a><a id="5856" class="Symbol">)</a> <a id="5858" href="Test.Golden.html#5858" class="Bound">mfp</a> <a id="5862" href="Test.Golden.html#5862" class="Bound">opts</a> <a id="5867" class="Symbol">=</a>
    <a id="5873" href="Test.Golden.html#5679" class="Function">go</a> <a id="5876" href="Test.Golden.html#5852" class="Bound">args</a> <a id="5881" href="Test.Golden.html#5858" class="Bound">mfp</a> <a id="5885" class="Symbol">(</a><a id="5886" class="Keyword">record</a> <a id="5893" href="Test.Golden.html#5862" class="Bound">opts</a> <a id="5898" class="Symbol">{</a> <a id="5900" href="Test.Golden.html#4696" class="Field">timing</a> <a id="5907" class="Symbol">=</a> <a id="5909" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="5914" class="Symbol">})</a>
  <a id="5919" href="Test.Golden.html#5679" class="Function">go</a> <a id="5922" class="Symbol">(</a><a id="5923" class="String">&quot;--interactive&quot;</a>       <a id="5945" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5947" href="Test.Golden.html#5947" class="Bound">args</a><a id="5951" class="Symbol">)</a> <a id="5953" href="Test.Golden.html#5953" class="Bound">mfp</a> <a id="5957" href="Test.Golden.html#5957" class="Bound">opts</a> <a id="5962" class="Symbol">=</a>
    <a id="5968" href="Test.Golden.html#5679" class="Function">go</a> <a id="5971" href="Test.Golden.html#5947" class="Bound">args</a> <a id="5976" href="Test.Golden.html#5953" class="Bound">mfp</a> <a id="5980" class="Symbol">(</a><a id="5981" class="Keyword">record</a> <a id="5988" href="Test.Golden.html#5957" class="Bound">opts</a> <a id="5993" class="Symbol">{</a> <a id="5995" href="Test.Golden.html#4628" class="Field">interactive</a> <a id="6007" class="Symbol">=</a> <a id="6009" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="6014" class="Symbol">})</a>
  <a id="6019" href="Test.Golden.html#5679" class="Function">go</a> <a id="6022" class="Symbol">(</a><a id="6023" class="String">&quot;--failure-file&quot;</a> <a id="6040" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6042" href="Test.Golden.html#6042" class="Bound">fp</a> <a id="6045" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6047" href="Test.Golden.html#6047" class="Bound">args</a><a id="6051" class="Symbol">)</a> <a id="6053" href="Test.Golden.html#6053" class="Bound">mfp</a> <a id="6057" href="Test.Golden.html#6057" class="Bound">opts</a> <a id="6062" class="Symbol">=</a>
    <a id="6068" href="Test.Golden.html#5679" class="Function">go</a> <a id="6071" href="Test.Golden.html#6047" class="Bound">args</a> <a id="6076" href="Test.Golden.html#6053" class="Bound">mfp</a> <a id="6080" class="Symbol">(</a><a id="6081" class="Keyword">record</a> <a id="6088" href="Test.Golden.html#6057" class="Bound">opts</a> <a id="6093" class="Symbol">{</a> <a id="6095" href="Test.Golden.html#4774" class="Field">failureFile</a> <a id="6107" class="Symbol">=</a> <a id="6109" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6114" href="Test.Golden.html#6042" class="Bound">fp</a> <a id="6117" class="Symbol">})</a>
  <a id="6122" href="Test.Golden.html#5679" class="Function">go</a> <a id="6125" class="Symbol">(</a><a id="6126" class="String">&quot;--only&quot;</a>              <a id="6148" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6150" href="Test.Golden.html#6150" class="Bound">args</a><a id="6154" class="Symbol">)</a> <a id="6156" href="Test.Golden.html#6156" class="Bound">mfp</a> <a id="6160" href="Test.Golden.html#6160" class="Bound">opts</a> <a id="6165" class="Symbol">=</a>
    <a id="6171" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6176" class="Symbol">(</a><a id="6177" href="Test.Golden.html#6156" class="Bound">mfp</a> <a id="6181" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6183" class="Symbol">(</a><a id="6184" class="Keyword">record</a> <a id="6191" href="Test.Golden.html#6160" class="Bound">opts</a> <a id="6196" class="Symbol">{</a> <a id="6198" href="Test.Golden.html#4549" class="Field">onlyNames</a> <a id="6208" class="Symbol">=</a> <a id="6210" href="Test.Golden.html#6150" class="Bound">args</a> <a id="6215" class="Symbol">}))</a>
  <a id="6221" href="Test.Golden.html#5679" class="Function">go</a> <a id="6224" class="Symbol">(</a><a id="6225" class="String">&quot;--only-file&quot;</a> <a id="6239" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6241" href="Test.Golden.html#6241" class="Bound">fp</a>    <a id="6247" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6249" href="Test.Golden.html#6249" class="Bound">args</a><a id="6253" class="Symbol">)</a> <a id="6255" href="Test.Golden.html#6255" class="Bound">mfp</a> <a id="6259" href="Test.Golden.html#6259" class="Bound">opts</a> <a id="6264" class="Symbol">=</a>
    <a id="6270" href="Test.Golden.html#5679" class="Function">go</a> <a id="6273" href="Test.Golden.html#6249" class="Bound">args</a> <a id="6278" class="Symbol">(</a><a id="6279" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6284" href="Test.Golden.html#6241" class="Bound">fp</a><a id="6286" class="Symbol">)</a> <a id="6288" class="Symbol">(</a><a id="6289" class="Keyword">record</a> <a id="6296" href="Test.Golden.html#6259" class="Bound">opts</a> <a id="6301" class="Symbol">{</a> <a id="6303" href="Test.Golden.html#4549" class="Field">onlyNames</a> <a id="6313" class="Symbol">=</a> <a id="6315" href="Test.Golden.html#6249" class="Bound">args</a> <a id="6320" class="Symbol">})</a>
  <a id="6325" href="Test.Golden.html#5679" class="Function">go</a> <a id="6328" class="Symbol">(</a><a id="6329" class="String">&quot;--no-colour&quot;</a>         <a id="6351" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6353" href="Test.Golden.html#6353" class="Bound">args</a><a id="6357" class="Symbol">)</a> <a id="6359" href="Test.Golden.html#6359" class="Bound">mfp</a> <a id="6363" href="Test.Golden.html#6363" class="Bound">opts</a> <a id="6368" class="Symbol">=</a>
    <a id="6374" href="Test.Golden.html#5679" class="Function">go</a> <a id="6377" href="Test.Golden.html#6353" class="Bound">args</a> <a id="6382" href="Test.Golden.html#6359" class="Bound">mfp</a> <a id="6386" class="Symbol">(</a><a id="6387" class="Keyword">record</a> <a id="6394" href="Test.Golden.html#6363" class="Bound">opts</a> <a id="6399" class="Symbol">{</a> <a id="6401" href="Test.Golden.html#4866" class="Field">colour</a> <a id="6408" class="Symbol">=</a> <a id="6410" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="6416" class="Symbol">})</a>
  <a id="6421" href="Test.Golden.html#5679" class="CatchallClause Function">go</a><a id="6423" class="CatchallClause"> </a><a id="6424" class="CatchallClause Symbol">(</a><a id="6425" href="Test.Golden.html#6425" class="CatchallClause Bound">arg</a><a id="6428" class="CatchallClause"> </a><a id="6429" href="Agda.Builtin.List.html#182" class="CatchallClause InductiveConstructor Operator">∷</a><a id="6430" class="CatchallClause"> </a><a id="6431" class="CatchallClause Symbol">_)</a><a id="6433" class="CatchallClause"> </a><a id="6434" class="CatchallClause Symbol">_</a><a id="6435" class="CatchallClause"> </a><a id="6436" class="CatchallClause Symbol">_</a> <a id="6438" class="Symbol">=</a> <a id="6440" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6445" href="Test.Golden.html#6425" class="Bound">arg</a>

  <a id="6452" href="Test.Golden.html#6452" class="Function">mkOptions</a> <a id="6462" class="Symbol">:</a> <a id="6464" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="6471" class="Symbol">→</a> <a id="6473" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="6478" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="6485" class="Symbol">→</a> <a id="6487" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="6490" class="Symbol">(</a><a id="6491" href="Test.Golden.html#5315" class="Datatype">Error</a> <a id="6497" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6499" href="Test.Golden.html#4396" class="Record">Options</a><a id="6506" class="Symbol">)</a>
  <a id="6510" href="Test.Golden.html#6452" class="Function">mkOptions</a> <a id="6520" href="Test.Golden.html#6520" class="Bound">exe</a> <a id="6524" href="Test.Golden.html#6524" class="Bound">rest</a> <a id="6529" class="Symbol">=</a> <a id="6531" class="Keyword">do</a>
    <a id="6538" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6543" class="Symbol">(</a><a id="6544" href="Test.Golden.html#6544" class="Bound">mfp</a> <a id="6548" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6550" href="Test.Golden.html#6550" class="Bound">opts</a><a id="6554" class="Symbol">)</a> <a id="6556" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6558" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6563" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="6565" href="Test.Golden.html#5679" class="Function">go</a> <a id="6568" href="Test.Golden.html#6524" class="Bound">rest</a> <a id="6573" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="6581" class="Symbol">(</a><a id="6582" href="Test.Golden.html#4894" class="Function">initOptions</a> <a id="6594" href="Test.Golden.html#6520" class="Bound">exe</a><a id="6597" class="Symbol">)</a>
      <a id="6605" class="Keyword">where</a> <a id="6611" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6616" href="Test.Golden.html#6616" class="Bound">arg</a> <a id="6620" class="Symbol">→</a> <a id="6622" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6627" class="Symbol">(</a><a id="6628" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6633" class="Symbol">(</a><a id="6634" href="Test.Golden.html#5363" class="InductiveConstructor">InvalidArgument</a> <a id="6650" href="Test.Golden.html#6616" class="Bound">arg</a><a id="6653" class="Symbol">))</a>
    <a id="6660" href="Test.Golden.html#6660" class="Bound">term</a> <a id="6665" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6667" href="Data.Maybe.Base.html#1656" class="Function">fromMaybe</a> <a id="6677" class="String">&quot;&quot;</a> <a id="6680" href="IO.Base.html#1973" class="Function Operator">&lt;$&gt;</a> <a id="6684" href="System.Environment.html#772" class="Function">lookupEnv</a> <a id="6694" class="String">&quot;TERM&quot;</a>
    <a id="6705" class="Keyword">let</a> <a id="6709" href="Test.Golden.html#6709" class="Bound">opts</a> <a id="6714" class="Symbol">=</a> <a id="6716" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="6719" href="Relation.Nullary.Decidable.Core.html#1555" class="Field">does</a> <a id="6724" class="Symbol">(</a><a id="6725" href="Test.Golden.html#6660" class="Bound">term</a> <a id="6730" href="Data.String.Properties.html#2294" class="Function Operator">≟</a> <a id="6732" class="String">&quot;DUMB&quot;</a><a id="6738" class="Symbol">)</a>
               <a id="6755" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="6760" class="Keyword">record</a> <a id="6767" href="Test.Golden.html#6550" class="Bound">opts</a> <a id="6772" class="Symbol">{</a> <a id="6774" href="Test.Golden.html#4866" class="Field">colour</a> <a id="6781" class="Symbol">=</a> <a id="6783" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="6789" class="Symbol">}</a>
               <a id="6806" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="6811" href="Test.Golden.html#6550" class="Bound">opts</a>
    <a id="6820" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6825" href="Test.Golden.html#6825" class="Bound">fp</a> <a id="6828" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6830" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6835" href="Test.Golden.html#6544" class="Bound">mfp</a>
      <a id="6845" class="Keyword">where</a> <a id="6851" class="CatchallClause Symbol">_</a> <a id="6853" class="Symbol">→</a> <a id="6855" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6860" class="Symbol">(</a><a id="6861" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6866" href="Test.Golden.html#6709" class="Bound">opts</a><a id="6870" class="Symbol">)</a>
    <a id="6876" href="Test.Golden.html#6876" class="Bound">only</a> <a id="6881" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6883" href="IO.html#2873" class="Function">readFiniteFile</a> <a id="6898" href="Test.Golden.html#6825" class="Bound">fp</a>
    <a id="6905" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6910" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="6912" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6917" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="6919" class="Keyword">record</a> <a id="6926" href="Test.Golden.html#6709" class="Bound">opts</a> <a id="6931" class="Symbol">{</a> <a id="6933" href="Test.Golden.html#4549" class="Field">onlyNames</a> <a id="6943" class="Symbol">=</a> <a id="6945" href="Data.String.Base.html#5107" class="Function">lines</a> <a id="6951" href="Test.Golden.html#6876" class="Bound">only</a> <a id="6956" href="Data.List.Base.html#1938" class="Function Operator">++</a> <a id="6959" href="Test.Golden.html#4549" class="Field">onlyNames</a> <a id="6969" href="Test.Golden.html#6709" class="Bound">opts</a> <a id="6974" class="Symbol">}</a>

<a id="6977" href="Test.Golden.html#5584" class="Function">options</a> <a id="6985" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="6988" class="Symbol">=</a> <a id="6990" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6995" class="Symbol">(</a><a id="6996" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7001" href="Test.Golden.html#5335" class="InductiveConstructor">MissingExecutable</a><a id="7018" class="Symbol">)</a>


<a id="7022" class="Comment">-- The result of a test run</a>
<a id="7050" class="Comment">-- `Left` corresponds to a failure and `Right` to a success</a>
<a id="Result"></a><a id="7110" href="Test.Golden.html#7110" class="Function">Result</a> <a id="7117" class="Symbol">:</a> <a id="7119" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="7123" href="Test.Golden.html#7110" class="Function">Result</a> <a id="7130" class="Symbol">=</a> <a id="7132" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="7139" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="7141" href="Agda.Builtin.String.html#318" class="Postulate">String</a>

<a id="7149" class="Comment">-- Run the specified golden test with the supplied options.</a>
<a id="runTest"></a><a id="7209" href="Test.Golden.html#7209" class="Function">runTest</a> <a id="7217" class="Symbol">:</a> <a id="7219" href="Test.Golden.html#4396" class="Record">Options</a> <a id="7227" class="Symbol">→</a> <a id="7229" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="7236" class="Symbol">→</a> <a id="7238" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="7241" href="Test.Golden.html#7110" class="Function">Result</a>
<a id="7248" href="Test.Golden.html#7209" class="Function">runTest</a> <a id="7256" href="Test.Golden.html#7256" class="Bound">opts</a> <a id="7261" href="Test.Golden.html#7261" class="Bound">testPath</a> <a id="7270" class="Symbol">=</a> <a id="7272" class="Keyword">do</a>

  <a id="7278" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="7283" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7285" href="System.Directory.html#3102" class="Function">doesDirectoryExist</a> <a id="7304" class="Symbol">(</a><a id="7305" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a> <a id="7316" href="Test.Golden.html#7261" class="Bound">testPath</a><a id="7324" class="Symbol">)</a>
    <a id="7330" class="Keyword">where</a> <a id="7336" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="7342" class="Symbol">→</a> <a id="7344" href="Test.Golden.html#8889" class="Function">fail</a> <a id="7349" href="Test.Golden.html#8510" class="Function">directoryNotFound</a>

  <a id="7370" href="Test.Golden.html#7370" class="Bound">time</a> <a id="7375" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7377" href="System.Clock.html#2764" class="Function">time′</a> <a id="7383" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7385" href="System.Process.html#649" class="Function">callCommand</a> <a id="7397" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7399" href="Data.String.Base.html#2766" class="Function">unwords</a>
           <a id="7418" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7420" class="String">&quot;cd&quot;</a> <a id="7425" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7427" href="Test.Golden.html#7261" class="Bound">testPath</a>
           <a id="7447" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7449" class="String">&quot;&amp;&amp;&quot;</a> <a id="7454" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7456" class="String">&quot;sh ./run&quot;</a> <a id="7467" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7469" href="Test.Golden.html#7256" class="Bound">opts</a> <a id="7474" class="Symbol">.</a><a id="7475" href="Test.Golden.html#4476" class="Field">exeUnderTest</a>
           <a id="7499" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7501" class="String">&quot;| tr -d &#39;\\r&#39; &gt; output&quot;</a>
           <a id="7537" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7539" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="7545" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="7550" href="Test.Golden.html#7550" class="Bound">out</a> <a id="7554" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7556" href="Test.Golden.html#8990" class="Function">readLocalFile</a> <a id="7570" class="String">&quot;output&quot;</a>
    <a id="7583" class="Keyword">where</a> <a id="7589" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="7597" class="Symbol">→</a> <a id="7599" href="Test.Golden.html#8889" class="Function">fail</a> <a id="7604" class="Symbol">(</a><a id="7605" href="Test.Golden.html#8689" class="Function">fileNotFound</a> <a id="7618" class="String">&quot;output&quot;</a><a id="7626" class="Symbol">)</a>
  <a id="7630" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="7635" href="Test.Golden.html#7635" class="Bound">exp</a> <a id="7639" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7641" href="Test.Golden.html#8990" class="Function">readLocalFile</a> <a id="7655" class="String">&quot;expected&quot;</a>
    <a id="7670" class="Keyword">where</a> <a id="7676" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="7684" class="Symbol">→</a> <a id="7686" class="Keyword">do</a> <a id="7689" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="7692" href="Test.Golden.html#7256" class="Bound">opts</a> <a id="7697" class="Symbol">.</a><a id="7698" href="Test.Golden.html#4628" class="Field">interactive</a>
                         <a id="7735" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="7740" href="Test.Golden.html#9757" class="Function">mayOverwrite</a> <a id="7753" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="7761" href="Test.Golden.html#7550" class="Bound">out</a>
                         <a id="7790" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="7795" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="7804" class="Symbol">(</a><a id="7805" href="Test.Golden.html#8689" class="Function">fileNotFound</a> <a id="7818" class="String">&quot;expected&quot;</a><a id="7828" class="Symbol">)</a>
                       <a id="7853" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="7858" class="Symbol">(</a><a id="7859" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7864" href="Test.Golden.html#7261" class="Bound">testPath</a><a id="7872" class="Symbol">)</a>

  <a id="7877" class="Keyword">let</a> <a id="7881" href="Test.Golden.html#7881" class="Bound">result</a> <a id="7888" class="Symbol">=</a> <a id="7890" href="Relation.Nullary.Decidable.Core.html#1555" class="Field">does</a> <a id="7895" class="Symbol">(</a><a id="7896" href="Test.Golden.html#7550" class="Bound">out</a> <a id="7900" href="Data.String.Properties.html#2294" class="Function Operator">String.≟</a> <a id="7909" href="Test.Golden.html#7635" class="Bound">exp</a><a id="7912" class="Symbol">)</a>

  <a id="7917" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="7920" href="Test.Golden.html#7881" class="Bound">result</a>
    <a id="7931" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="7936" href="Test.Golden.html#10573" class="Function">printTiming</a> <a id="7948" class="Symbol">(</a><a id="7949" href="Test.Golden.html#7256" class="Bound">opts</a> <a id="7954" class="Symbol">.</a><a id="7955" href="Test.Golden.html#4696" class="Field">timing</a><a id="7961" class="Symbol">)</a> <a id="7963" href="Test.Golden.html#7370" class="Bound">time</a>
           <a id="7979" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7981" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="7984" href="Test.Golden.html#7256" class="Bound">opts</a> <a id="7989" class="Symbol">.</a><a id="7990" href="Test.Golden.html#4866" class="Field">colour</a>
               <a id="8012" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8017" href="System.Console.ANSI.html#2073" class="Function">withCommand</a> <a id="8029" class="Symbol">(</a><a id="8030" href="System.Console.ANSI.html#974" class="InductiveConstructor">setColour</a> <a id="8040" href="System.Console.ANSI.html#543" class="InductiveConstructor">foreground</a> <a id="8051" href="System.Console.ANSI.html#686" class="InductiveConstructor">classic</a> <a id="8059" href="System.Console.ANSI.html#610" class="InductiveConstructor">green</a><a id="8064" class="Symbol">)</a>
               <a id="8081" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8086" href="Function.Base.html#704" class="Function">id</a>
           <a id="8100" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8102" class="String">&quot;success&quot;</a>
    <a id="8116" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8121" class="Keyword">do</a> <a id="8124" href="Test.Golden.html#10573" class="Function">printTiming</a> <a id="8136" class="Symbol">(</a><a id="8137" href="Test.Golden.html#7256" class="Bound">opts</a> <a id="8142" class="Symbol">.</a><a id="8143" href="Test.Golden.html#4696" class="Field">timing</a><a id="8149" class="Symbol">)</a> <a id="8151" href="Test.Golden.html#7370" class="Bound">time</a>
             <a id="8169" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8171" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="8174" href="Test.Golden.html#7256" class="Bound">opts</a> <a id="8179" class="Symbol">.</a><a id="8180" href="Test.Golden.html#4866" class="Field">colour</a>
               <a id="8202" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8207" href="System.Console.ANSI.html#2073" class="Function">withCommand</a> <a id="8219" class="Symbol">(</a><a id="8220" href="System.Console.ANSI.html#974" class="InductiveConstructor">setColour</a> <a id="8230" href="System.Console.ANSI.html#543" class="InductiveConstructor">foreground</a> <a id="8241" href="System.Console.ANSI.html#694" class="InductiveConstructor">bright</a> <a id="8248" href="System.Console.ANSI.html#606" class="InductiveConstructor">red</a><a id="8251" class="Symbol">)</a>
               <a id="8268" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8273" href="Function.Base.html#704" class="Function">id</a>
             <a id="8289" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8291" class="String">&quot;FAILURE&quot;</a>
            <a id="8313" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="8316" href="Test.Golden.html#7256" class="Bound">opts</a> <a id="8321" class="Symbol">.</a><a id="8322" href="Test.Golden.html#4628" class="Field">interactive</a>
              <a id="8348" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8353" href="Test.Golden.html#9757" class="Function">mayOverwrite</a> <a id="8366" class="Symbol">(</a><a id="8367" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="8372" href="Test.Golden.html#7635" class="Bound">exp</a><a id="8375" class="Symbol">)</a> <a id="8377" href="Test.Golden.html#7550" class="Bound">out</a>
              <a id="8395" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8400" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="8409" class="Symbol">(</a><a id="8410" href="Data.String.Base.html#2824" class="Function">unlines</a> <a id="8418" class="Symbol">(</a><a id="8419" href="Test.Golden.html#9523" class="Function">expVsOut</a> <a id="8428" href="Test.Golden.html#7635" class="Bound">exp</a> <a id="8432" href="Test.Golden.html#7550" class="Bound">out</a><a id="8435" class="Symbol">))</a>

  <a id="8441" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="8446" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8448" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="8451" href="Test.Golden.html#7881" class="Bound">result</a> <a id="8458" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8463" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="8468" href="Test.Golden.html#7261" class="Bound">testPath</a> <a id="8477" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8482" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="8487" href="Test.Golden.html#7261" class="Bound">testPath</a>

  <a id="8499" class="Keyword">where</a>

    <a id="8510" href="Test.Golden.html#8510" class="Function">directoryNotFound</a> <a id="8528" class="Symbol">:</a> <a id="8530" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="8541" href="Test.Golden.html#8510" class="Function">directoryNotFound</a> <a id="8559" class="Symbol">=</a> <a id="8561" href="Data.String.Base.html#2766" class="Function">unwords</a>
                      <a id="8591" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8593" class="String">&quot;Directory&quot;</a>
                      <a id="8627" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8629" href="Test.Golden.html#7261" class="Bound">testPath</a>
                      <a id="8660" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8662" class="String">&quot;does not exist&quot;</a> <a id="8679" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8681" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

    <a id="8689" href="Test.Golden.html#8689" class="Function">fileNotFound</a> <a id="8702" class="Symbol">:</a> <a id="8704" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="8711" class="Symbol">→</a> <a id="8713" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="8724" href="Test.Golden.html#8689" class="Function">fileNotFound</a> <a id="8737" href="Test.Golden.html#8737" class="Bound">name</a> <a id="8742" class="Symbol">=</a> <a id="8744" href="Data.String.Base.html#2766" class="Function">unwords</a>
                      <a id="8774" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8776" class="String">&quot;File&quot;</a>
                      <a id="8805" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8807" class="Symbol">(</a><a id="8808" href="Test.Golden.html#7261" class="Bound">testPath</a> <a id="8817" href="Data.String.Base.html#2423" class="Function Operator">String.++</a> <a id="8827" class="String">&quot;/output&quot;</a><a id="8836" class="Symbol">)</a>
                      <a id="8860" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8862" class="String">&quot;does not exist&quot;</a> <a id="8879" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8881" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

    <a id="8889" href="Test.Golden.html#8889" class="Function">fail</a> <a id="8894" class="Symbol">:</a> <a id="8896" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="8903" class="Symbol">→</a> <a id="8905" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="8908" href="Test.Golden.html#7110" class="Function">Result</a>
    <a id="8919" href="Test.Golden.html#8889" class="Function">fail</a> <a id="8924" href="Test.Golden.html#8924" class="Bound">msg</a> <a id="8928" class="Symbol">=</a> <a id="8930" class="Keyword">do</a> <a id="8933" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="8942" href="Test.Golden.html#8924" class="Bound">msg</a>
                  <a id="8964" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="8969" class="Symbol">(</a><a id="8970" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="8975" href="Test.Golden.html#7261" class="Bound">testPath</a><a id="8983" class="Symbol">)</a>

    <a id="8990" href="Test.Golden.html#8990" class="Function">readLocalFile</a> <a id="9004" class="Symbol">:</a> <a id="9006" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9013" class="Symbol">→</a> <a id="9015" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9018" class="Symbol">(</a><a id="9019" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="9025" href="Agda.Builtin.String.html#318" class="Postulate">String</a><a id="9031" class="Symbol">)</a>
    <a id="9037" href="Test.Golden.html#8990" class="Function">readLocalFile</a> <a id="9051" href="Test.Golden.html#9051" class="Bound">name</a> <a id="9056" class="Symbol">=</a> <a id="9058" class="Keyword">do</a>
      <a id="9067" class="Keyword">let</a> <a id="9071" href="Test.Golden.html#9071" class="Bound">fp</a> <a id="9074" class="Symbol">=</a> <a id="9076" href="Data.String.Base.html#2611" class="Function">concat</a> <a id="9083" class="Symbol">(</a><a id="9084" href="Test.Golden.html#7261" class="Bound">testPath</a> <a id="9093" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9095" class="String">&quot;/&quot;</a> <a id="9099" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9101" href="Test.Golden.html#9051" class="Bound">name</a> <a id="9106" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9108" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="9110" class="Symbol">)</a>
      <a id="9118" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="9123" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="9125" href="System.Directory.html#3050" class="Function">doesFileExist</a> <a id="9139" class="Symbol">(</a><a id="9140" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a> <a id="9151" href="Test.Golden.html#9071" class="Bound">fp</a><a id="9153" class="Symbol">)</a>
        <a id="9163" class="Keyword">where</a> <a id="9169" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="9175" class="Symbol">→</a> <a id="9177" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9182" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
      <a id="9196" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9201" href="IO.Base.html#1973" class="Function Operator">&lt;$&gt;</a> <a id="9205" href="IO.html#2873" class="Function">readFiniteFile</a> <a id="9220" href="Test.Golden.html#9071" class="Bound">fp</a>

    <a id="9228" href="Test.Golden.html#9228" class="Function">getAnswer</a> <a id="9238" class="Symbol">:</a> <a id="9240" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9243" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="9252" href="Test.Golden.html#9228" class="Function">getAnswer</a> <a id="9262" class="Symbol">=</a> <a id="9264" href="IO.Base.html#3674" class="Function">untilJust</a> <a id="9274" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9276" class="Keyword">do</a>
      <a id="9285" href="Test.Golden.html#9285" class="Bound">str</a> <a id="9289" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="9291" href="IO.Finite.html#1045" class="Function">getLine</a>
      <a id="9305" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="9310" href="Test.Golden.html#9285" class="Bound">str</a> <a id="9314" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="9317" class="Symbol">λ</a> <a id="9319" class="Keyword">where</a>
        <a id="9333" class="String">&quot;y&quot;</a> <a id="9337" class="Symbol">→</a> <a id="9339" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9344" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9346" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9351" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
        <a id="9364" class="String">&quot;n&quot;</a> <a id="9368" class="Symbol">→</a> <a id="9370" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9375" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9377" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9382" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
        <a id="9396" class="String">&quot;&quot;</a>  <a id="9400" class="Symbol">→</a> <a id="9402" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9407" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9409" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9414" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="9420" class="Comment">-- default answer is no</a>
        <a id="9452" class="Symbol">_</a>   <a id="9456" class="Symbol">→</a> <a id="9458" class="Keyword">do</a> <a id="9461" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="9470" class="String">&quot;Invalid answer.&quot;</a>
                 <a id="9505" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9510" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>

    <a id="9523" href="Test.Golden.html#9523" class="Function">expVsOut</a> <a id="9532" class="Symbol">:</a> <a id="9534" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9541" class="Symbol">→</a> <a id="9543" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9550" class="Symbol">→</a> <a id="9552" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="9557" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="9568" href="Test.Golden.html#9523" class="Function">expVsOut</a> <a id="9577" href="Test.Golden.html#9577" class="Bound">exp</a> <a id="9581" href="Test.Golden.html#9581" class="Bound">out</a> <a id="9585" class="Symbol">=</a> <a id="9587" class="String">&quot;Expected:&quot;</a> <a id="9599" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9601" href="Test.Golden.html#9577" class="Bound">exp</a> <a id="9605" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9607" class="String">&quot;Given:&quot;</a> <a id="9616" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9618" href="Test.Golden.html#9581" class="Bound">out</a> <a id="9622" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9624" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

    <a id="9632" href="Test.Golden.html#9632" class="Function">hasFailed</a> <a id="9642" class="Symbol">:</a> <a id="9644" href="System.Exit.Primitive.html#402" class="Datatype">ExitCode</a> <a id="9653" class="Symbol">→</a> <a id="9655" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="9664" href="Test.Golden.html#9632" class="Function">hasFailed</a> <a id="9674" href="System.Exit.Primitive.html#425" class="InductiveConstructor">ExitSuccess</a>        <a id="9693" class="Symbol">=</a> <a id="9695" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
    <a id="9705" href="Test.Golden.html#9632" class="Function">hasFailed</a> <a id="9715" class="Symbol">(</a><a id="9716" href="System.Exit.Primitive.html#450" class="InductiveConstructor">ExitFailure</a> <a id="9728" href="Test.Golden.html#9728" class="Bound">code</a><a id="9732" class="Symbol">)</a> <a id="9734" class="Symbol">=</a> <a id="9736" href="Test.Golden.html#9728" class="Bound">code</a> <a id="9741" href="Data.Integer.Base.html#2610" class="Function Operator">ℤ.≤ᵇ</a> <a id="9746" href="Agda.Builtin.Int.html#246" class="InductiveConstructor Operator">ℤ.+</a> <a id="9750" class="Number">0</a>

    <a id="9757" href="Test.Golden.html#9757" class="Function">mayOverwrite</a> <a id="9770" class="Symbol">:</a> <a id="9772" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="9778" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9785" class="Symbol">→</a> <a id="9787" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9794" class="Symbol">→</a> <a id="9796" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9799" class="Symbol">_</a>
    <a id="9805" href="Test.Golden.html#9757" class="Function">mayOverwrite</a> <a id="9818" href="Test.Golden.html#9818" class="Bound">mexp</a> <a id="9823" href="Test.Golden.html#9823" class="Bound">out</a> <a id="9827" class="Symbol">=</a> <a id="9829" class="Keyword">do</a>
      <a id="9838" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="9843" href="Test.Golden.html#9818" class="Bound">mexp</a> <a id="9848" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="9851" class="Symbol">λ</a> <a id="9853" class="Keyword">where</a>
        <a id="9867" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="9875" class="Symbol">→</a> <a id="9877" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="9886" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9888" href="Data.String.Base.html#2824" class="Function">unlines</a>
          <a id="9906" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9908" class="String">&quot;Golden value missing. I computed the following result:&quot;</a>
          <a id="9975" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9977" href="Test.Golden.html#9823" class="Bound">out</a>
          <a id="9991" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9993" class="String">&quot;Accept new golden value? [y/N]&quot;</a>
          <a id="10036" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10038" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
        <a id="10049" class="Symbol">(</a><a id="10050" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="10055" href="Test.Golden.html#10055" class="Bound">exp</a><a id="10058" class="Symbol">)</a> <a id="10060" class="Symbol">→</a> <a id="10062" class="Keyword">do</a>
          <a id="10075" href="Test.Golden.html#10075" class="Bound">code</a> <a id="10080" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="10082" href="System.Process.html#729" class="Function">system</a> <a id="10089" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10091" href="Data.String.Base.html#2611" class="Function">concat</a>
            <a id="10110" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10112" class="String">&quot;git diff --no-index --exit-code --word-diff=color &quot;</a>
            <a id="10177" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10179" href="Test.Golden.html#7261" class="Bound">testPath</a> <a id="10188" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10190" class="String">&quot;/expected &quot;</a>
            <a id="10215" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10217" href="Test.Golden.html#7261" class="Bound">testPath</a> <a id="10226" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10228" class="String">&quot;/output&quot;</a>
            <a id="10250" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10252" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
          <a id="10265" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="10274" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10276" href="Data.String.Base.html#2824" class="Function">unlines</a>
            <a id="10296" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10298" class="String">&quot;Golden value differs from actual value.&quot;</a>
            <a id="10352" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10354" class="Symbol">(</a><a id="10355" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="10358" href="Test.Golden.html#9632" class="Function">hasFailed</a> <a id="10368" href="Test.Golden.html#10075" class="Bound">code</a> <a id="10373" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="10378" href="Test.Golden.html#9523" class="Function">expVsOut</a> <a id="10387" href="Test.Golden.html#10055" class="Bound">exp</a> <a id="10391" href="Test.Golden.html#9823" class="Bound">out</a> <a id="10395" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="10400" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="10402" class="Symbol">)</a>
            <a id="10416" href="Data.List.Base.html#1938" class="Function Operator">++</a> <a id="10419" class="String">&quot;Accept actual value as new golden value? [y/N]&quot;</a>
            <a id="10480" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10482" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

      <a id="10492" href="Test.Golden.html#10492" class="Bound">b</a> <a id="10494" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="10496" href="Test.Golden.html#9228" class="Function">getAnswer</a>
      <a id="10512" href="IO.Base.html#3334" class="Function">when</a> <a id="10517" href="Test.Golden.html#10492" class="Bound">b</a> <a id="10519" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10521" href="IO.Finite.html#1276" class="Function">writeFile</a> <a id="10531" class="Symbol">(</a><a id="10532" href="Test.Golden.html#7261" class="Bound">testPath</a> <a id="10541" href="Data.String.Base.html#2423" class="Function Operator">String.++</a> <a id="10551" class="String">&quot;/expected&quot;</a><a id="10562" class="Symbol">)</a> <a id="10564" href="Test.Golden.html#9823" class="Bound">out</a>

    <a id="10573" href="Test.Golden.html#10573" class="Function">printTiming</a> <a id="10585" class="Symbol">:</a> <a id="10587" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a> <a id="10592" class="Symbol">→</a> <a id="10594" href="System.Clock.html#1919" class="Record">Time</a> <a id="10599" class="Symbol">→</a> <a id="10601" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="10608" class="Symbol">→</a> <a id="10610" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="10613" class="Symbol">_</a>
    <a id="10619" href="Test.Golden.html#10573" class="Function">printTiming</a> <a id="10631" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="10637" class="Symbol">_</a>    <a id="10642" href="Test.Golden.html#10642" class="Bound">msg</a> <a id="10646" class="Symbol">=</a> <a id="10648" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="10657" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10659" href="Data.String.Base.html#2611" class="Function">concat</a> <a id="10666" class="Symbol">(</a><a id="10667" href="Test.Golden.html#7261" class="Bound">testPath</a> <a id="10676" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10678" class="String">&quot;: &quot;</a> <a id="10683" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10685" href="Test.Golden.html#10642" class="Bound">msg</a> <a id="10689" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10691" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="10693" class="Symbol">)</a>
    <a id="10699" href="Test.Golden.html#10573" class="Function">printTiming</a> <a id="10711" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>  <a id="10717" href="Test.Golden.html#10717" class="Bound">time</a> <a id="10722" href="Test.Golden.html#10722" class="Bound">msg</a> <a id="10726" class="Symbol">=</a>
      <a id="10734" class="Keyword">let</a> <a id="10738" href="Test.Golden.html#10738" class="Bound">time</a>  <a id="10744" class="Symbol">=</a> <a id="10746" href="Data.Nat.Show.html#1933" class="Function">ℕ.show</a> <a id="10753" class="Symbol">(</a><a id="10754" href="Test.Golden.html#10717" class="Bound">time</a> <a id="10759" class="Symbol">.</a><a id="10760" href="System.Clock.html#1965" class="Field">seconds</a><a id="10767" class="Symbol">)</a> <a id="10769" href="Data.String.Base.html#2423" class="Function Operator">String.++</a> <a id="10779" class="String">&quot;s&quot;</a>
          <a id="10793" href="Test.Golden.html#10793" class="Bound">spent</a> <a id="10799" class="Symbol">=</a> <a id="10801" class="Number">9</a> <a id="10803" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+</a> <a id="10805" href="Data.List.Base.html#4987" class="Function">List.sum</a> <a id="10814" class="Symbol">(</a><a id="10815" href="Data.List.Base.html#1615" class="Function">List.map</a> <a id="10824" href="Data.String.Base.html#2487" class="Function">String.length</a> <a id="10838" class="Symbol">(</a><a id="10839" href="Test.Golden.html#7261" class="Bound">testPath</a> <a id="10848" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10850" href="Test.Golden.html#10738" class="Bound">time</a> <a id="10855" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10857" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="10859" class="Symbol">))</a>
               <a id="10877" class="Comment">-- ^ hack: both &quot;success&quot; and &quot;FAILURE&quot; have the same length</a>
               <a id="10953" class="Comment">--   can&#39;t use `String.length msg` because the msg contains escape codes</a>
          <a id="11036" href="Test.Golden.html#11036" class="Bound">pad</a>   <a id="11042" class="Symbol">=</a> <a id="11044" href="Data.String.Base.html#2538" class="Function">String.replicate</a> <a id="11061" class="Symbol">(</a><a id="11062" class="Number">72</a> <a id="11065" href="Data.Nat.Base.html#3211" class="Primitive Operator">∸</a> <a id="11067" href="Test.Golden.html#10793" class="Bound">spent</a><a id="11072" class="Symbol">)</a> <a id="11074" class="String">&#39; &#39;</a>
      <a id="11084" class="Keyword">in</a> <a id="11087" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="11096" class="Symbol">(</a><a id="11097" href="Data.String.Base.html#2611" class="Function">concat</a> <a id="11104" class="Symbol">(</a><a id="11105" href="Test.Golden.html#7261" class="Bound">testPath</a> <a id="11114" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11116" class="String">&quot;: &quot;</a> <a id="11121" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11123" href="Test.Golden.html#10722" class="Bound">msg</a> <a id="11127" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11129" href="Test.Golden.html#11036" class="Bound">pad</a> <a id="11133" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11135" href="Test.Golden.html#10738" class="Bound">time</a> <a id="11140" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11142" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="11144" class="Symbol">))</a>

<a id="11148" class="Comment">-- A test pool is characterised by</a>
<a id="11183" class="Comment">--  + a name</a>
<a id="11196" class="Comment">--  + and a list of directory paths</a>
<a id="11232" class="Keyword">record</a> <a id="TestPool"></a><a id="11239" href="Test.Golden.html#11239" class="Record">TestPool</a> <a id="11248" class="Symbol">:</a> <a id="11250" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="11254" class="Keyword">where</a>
  <a id="11262" class="Keyword">constructor</a> <a id="mkTestPool"></a><a id="11274" href="Test.Golden.html#11274" class="InductiveConstructor">mkTestPool</a>
  <a id="11287" class="Keyword">field</a>
    <a id="TestPool.poolName"></a><a id="11297" href="Test.Golden.html#11297" class="Field">poolName</a> <a id="11306" class="Symbol">:</a> <a id="11308" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="TestPool.testCases"></a><a id="11319" href="Test.Golden.html#11319" class="Field">testCases</a> <a id="11329" class="Symbol">:</a> <a id="11331" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11336" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="11343" class="Keyword">open</a> <a id="11348" href="Test.Golden.html#11239" class="Module">TestPool</a>

<a id="11358" class="Keyword">module</a> <a id="Summary"></a><a id="11365" href="Test.Golden.html#11365" class="Module">Summary</a> <a id="11373" class="Keyword">where</a>

  <a id="11382" class="Comment">-- The summary of a test pool run</a>
  <a id="11418" class="Keyword">record</a> <a id="Summary.Summary"></a><a id="11425" href="Test.Golden.html#11425" class="Record">Summary</a> <a id="11433" class="Symbol">:</a> <a id="11435" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="11439" class="Keyword">where</a>
    <a id="11449" class="Keyword">constructor</a> <a id="Summary.mkSummary"></a><a id="11461" href="Test.Golden.html#11461" class="InductiveConstructor">mkSummary</a>
    <a id="11475" class="Keyword">field</a>
      <a id="Summary.Summary.success"></a><a id="11487" href="Test.Golden.html#11487" class="Field">success</a> <a id="11495" class="Symbol">:</a> <a id="11497" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11502" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
      <a id="Summary.Summary.failure"></a><a id="11515" href="Test.Golden.html#11515" class="Field">failure</a> <a id="11523" class="Symbol">:</a> <a id="11525" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11530" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
  <a id="11539" class="Keyword">open</a> <a id="11544" href="Test.Golden.html#11425" class="Module">Summary</a> <a id="11552" class="Keyword">public</a>

  <a id="Summary.init"></a><a id="11562" href="Test.Golden.html#11562" class="Function">init</a> <a id="11567" class="Symbol">:</a> <a id="11569" href="Test.Golden.html#11425" class="Record">Summary</a>
  <a id="11579" href="Test.Golden.html#11562" class="Function">init</a> <a id="11584" class="Symbol">=</a> <a id="11586" href="Test.Golden.html#11461" class="InductiveConstructor">mkSummary</a> <a id="11596" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="11599" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="Summary.merge"></a><a id="11605" href="Test.Golden.html#11605" class="Function">merge</a> <a id="11611" class="Symbol">:</a> <a id="11613" href="Test.Golden.html#11425" class="Record">Summary</a> <a id="11621" class="Symbol">→</a> <a id="11623" href="Test.Golden.html#11425" class="Record">Summary</a> <a id="11631" class="Symbol">→</a> <a id="11633" href="Test.Golden.html#11425" class="Record">Summary</a>
  <a id="11643" href="Test.Golden.html#11605" class="Function">merge</a> <a id="11649" class="Symbol">(</a><a id="11650" href="Test.Golden.html#11461" class="InductiveConstructor">mkSummary</a> <a id="11660" href="Test.Golden.html#11660" class="Bound">ws1</a> <a id="11664" href="Test.Golden.html#11664" class="Bound">ls1</a><a id="11667" class="Symbol">)</a> <a id="11669" class="Symbol">(</a><a id="11670" href="Test.Golden.html#11461" class="InductiveConstructor">mkSummary</a> <a id="11680" href="Test.Golden.html#11680" class="Bound">ws2</a> <a id="11684" href="Test.Golden.html#11684" class="Bound">ls2</a><a id="11687" class="Symbol">)</a> <a id="11689" class="Symbol">=</a>
   <a id="11694" href="Test.Golden.html#11461" class="InductiveConstructor">mkSummary</a> <a id="11704" class="Symbol">(</a><a id="11705" href="Test.Golden.html#11680" class="Bound">ws2</a> <a id="11709" href="Data.List.Base.html#1938" class="Function Operator">++</a> <a id="11712" href="Test.Golden.html#11660" class="Bound">ws1</a><a id="11715" class="Symbol">)</a> <a id="11717" class="Symbol">(</a><a id="11718" href="Test.Golden.html#11684" class="Bound">ls2</a> <a id="11722" href="Data.List.Base.html#1938" class="Function Operator">++</a> <a id="11725" href="Test.Golden.html#11664" class="Bound">ls1</a><a id="11728" class="Symbol">)</a>

  <a id="Summary.update"></a><a id="11733" href="Test.Golden.html#11733" class="Function">update</a> <a id="11740" class="Symbol">:</a> <a id="11742" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11747" href="Test.Golden.html#7110" class="Function">Result</a> <a id="11754" class="Symbol">→</a> <a id="11756" href="Test.Golden.html#11425" class="Record">Summary</a> <a id="11764" class="Symbol">→</a> <a id="11766" href="Test.Golden.html#11425" class="Record">Summary</a>
  <a id="11776" href="Test.Golden.html#11733" class="Function">update</a> <a id="11783" href="Test.Golden.html#11783" class="Bound">res</a> <a id="11787" href="Test.Golden.html#11787" class="Bound">sum</a> <a id="11791" class="Symbol">=</a>
    <a id="11797" class="Keyword">let</a> <a id="11801" class="Symbol">(</a><a id="11802" href="Test.Golden.html#11802" class="Bound">ls2</a> <a id="11806" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11808" href="Test.Golden.html#11808" class="Bound">ws2</a><a id="11811" class="Symbol">)</a> <a id="11813" class="Symbol">=</a> <a id="11815" href="Data.List.Base.html#3888" class="Function">partitionSums</a> <a id="11829" href="Test.Golden.html#11783" class="Bound">res</a> <a id="11833" class="Keyword">in</a>
    <a id="11840" href="Test.Golden.html#11605" class="Function">merge</a> <a id="11846" href="Test.Golden.html#11787" class="Bound">sum</a> <a id="11850" class="Symbol">(</a><a id="11851" href="Test.Golden.html#11461" class="InductiveConstructor">mkSummary</a> <a id="11861" href="Test.Golden.html#11808" class="Bound">ws2</a> <a id="11865" href="Test.Golden.html#11802" class="Bound">ls2</a><a id="11868" class="Symbol">)</a>

<a id="11871" class="Keyword">open</a> <a id="11876" href="Test.Golden.html#11365" class="Module">Summary</a> <a id="11884" class="Keyword">using</a> <a id="11890" class="Symbol">(</a><a id="11891" href="Test.Golden.html#11425" class="Record">Summary</a><a id="11898" class="Symbol">)</a> <a id="11900" class="Keyword">hiding</a> <a id="11907" class="Symbol">(</a><a id="11908" class="Keyword">module</a> <a id="11915" href="Test.Golden.html#11425" class="Module">Summary</a><a id="11922" class="Symbol">)</a>

<a id="11925" class="Comment">-- Only keep the tests that have been asked for</a>
<a id="filterTests"></a><a id="11973" href="Test.Golden.html#11973" class="Function">filterTests</a> <a id="11985" class="Symbol">:</a> <a id="11987" href="Test.Golden.html#4396" class="Record">Options</a> <a id="11995" class="Symbol">→</a> <a id="11997" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12002" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="12009" class="Symbol">→</a> <a id="12011" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12016" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="12023" href="Test.Golden.html#11973" class="Function">filterTests</a> <a id="12035" href="Test.Golden.html#12035" class="Bound">opts</a> <a id="12040" class="Symbol">=</a> <a id="12042" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="12047" href="Test.Golden.html#4549" class="Field">onlyNames</a> <a id="12057" href="Test.Golden.html#12035" class="Bound">opts</a> <a id="12062" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="12065" class="Symbol">λ</a> <a id="12067" class="Keyword">where</a>
  <a id="12075" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="12078" class="Symbol">→</a> <a id="12080" href="Function.Base.html#704" class="Function">id</a>
  <a id="12085" href="Test.Golden.html#12085" class="CatchallClause Bound">xs</a> <a id="12088" class="Symbol">→</a> <a id="12090" class="Keyword">let</a> <a id="12094" href="Test.Golden.html#12094" class="Bound">names</a> <a id="12100" class="Symbol">=</a> <a id="12102" href="Data.List.Base.html#1615" class="Function">List.map</a> <a id="12111" href="Data.String.Base.html#1550" class="Primitive">String.toList</a> <a id="12125" href="Test.Golden.html#12085" class="Bound">xs</a> <a id="12128" class="Keyword">in</a>
       <a id="12138" href="Data.List.Base.html#11412" class="Function">filter</a> <a id="12145" class="Symbol">(λ</a> <a id="12148" href="Test.Golden.html#12148" class="Bound">n</a> <a id="12150" class="Symbol">→</a> <a id="12152" href="Data.List.Relation.Unary.Any.html#2660" class="Function">any?</a> <a id="12157" class="Symbol">(λ</a> <a id="12160" href="Test.Golden.html#12160" class="Bound">m</a> <a id="12162" class="Symbol">→</a> <a id="12164" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6659" class="Function">infix?</a> <a id="12171" href="Data.Char.Properties.html#1499" class="Function Operator">Char._≟_</a> <a id="12180" href="Test.Golden.html#12160" class="Bound">m</a> <a id="12182" class="Symbol">(</a><a id="12183" href="Data.String.Base.html#1550" class="Primitive">String.toList</a> <a id="12197" href="Test.Golden.html#12148" class="Bound">n</a><a id="12198" class="Symbol">))</a> <a id="12201" href="Test.Golden.html#12094" class="Bound">names</a><a id="12206" class="Symbol">)</a>

<a id="poolRunner"></a><a id="12209" href="Test.Golden.html#12209" class="Function">poolRunner</a> <a id="12220" class="Symbol">:</a> <a id="12222" href="Test.Golden.html#4396" class="Record">Options</a> <a id="12230" class="Symbol">→</a> <a id="12232" href="Test.Golden.html#11239" class="Record">TestPool</a> <a id="12241" class="Symbol">→</a> <a id="12243" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="12246" href="Test.Golden.html#11425" class="Record">Summary</a>
<a id="12254" href="Test.Golden.html#12209" class="Function">poolRunner</a> <a id="12265" href="Test.Golden.html#12265" class="Bound">opts</a> <a id="12270" href="Test.Golden.html#12270" class="Bound">pool</a> <a id="12275" class="Symbol">=</a> <a id="12277" class="Keyword">do</a>
  <a id="12282" class="Comment">-- check there is a non-empty list of tests we want to run</a>
  <a id="12343" class="Keyword">let</a> <a id="12347" href="Test.Golden.html#12347" class="Bound">tests</a> <a id="12353" class="Symbol">=</a> <a id="12355" href="Test.Golden.html#11973" class="Function">filterTests</a> <a id="12367" href="Test.Golden.html#12265" class="Bound">opts</a> <a id="12372" class="Symbol">(</a><a id="12373" href="Test.Golden.html#12270" class="Bound">pool</a> <a id="12378" class="Symbol">.</a><a id="12379" href="Test.Golden.html#11319" class="Field">testCases</a><a id="12388" class="Symbol">)</a>
  <a id="12392" class="Symbol">(_</a> <a id="12395" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12397" class="Symbol">_)</a> <a id="12400" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="12402" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12407" href="Test.Golden.html#12347" class="Bound">tests</a>
    <a id="12417" class="Keyword">where</a> <a id="12423" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="12426" class="Symbol">→</a> <a id="12428" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12433" href="Test.Golden.html#11562" class="Function">Summary.init</a>

  <a id="12449" class="Comment">-- announce the test pool and run them</a>
  <a id="12490" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="12499" href="Test.Golden.html#12604" class="Function">banner</a>
  <a id="12508" href="Test.Golden.html#12734" class="Function">loop</a> <a id="12513" href="Test.Golden.html#11562" class="Function">Summary.init</a> <a id="12526" href="Test.Golden.html#12347" class="Bound">tests</a>

  <a id="12535" class="Keyword">where</a>

  <a id="12544" href="Test.Golden.html#12544" class="Function">separator</a> <a id="12554" class="Symbol">:</a> <a id="12556" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
  <a id="12565" href="Test.Golden.html#12544" class="Function">separator</a> <a id="12575" class="Symbol">=</a> <a id="12577" href="Data.String.Base.html#2538" class="Function">String.replicate</a> <a id="12594" class="Number">72</a> <a id="12597" class="String">&#39;-&#39;</a>

  <a id="12604" href="Test.Golden.html#12604" class="Function">banner</a> <a id="12611" class="Symbol">:</a> <a id="12613" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
  <a id="12622" href="Test.Golden.html#12604" class="Function">banner</a> <a id="12629" class="Symbol">=</a> <a id="12631" href="Data.String.Base.html#2824" class="Function">unlines</a>
         <a id="12648" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="12650" class="String">&quot;&quot;</a> <a id="12653" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12655" href="Test.Golden.html#12544" class="Function">separator</a>
         <a id="12674" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12676" href="Test.Golden.html#12270" class="Bound">pool</a> <a id="12681" class="Symbol">.</a><a id="12682" href="Test.Golden.html#11297" class="Field">poolName</a>
         <a id="12700" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12702" href="Test.Golden.html#12544" class="Function">separator</a> <a id="12712" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12714" class="String">&quot;&quot;</a>
         <a id="12726" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12728" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="12734" href="Test.Golden.html#12734" class="Function">loop</a> <a id="12739" class="Symbol">:</a> <a id="12741" href="Test.Golden.html#11425" class="Record">Summary</a> <a id="12749" class="Symbol">→</a> <a id="12751" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12756" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="12763" class="Symbol">→</a> <a id="12765" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="12768" href="Test.Golden.html#11425" class="Record">Summary</a>
  <a id="12778" href="Test.Golden.html#12734" class="Function">loop</a> <a id="12783" href="Test.Golden.html#12783" class="Bound">acc</a> <a id="12787" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="12790" class="Symbol">=</a> <a id="12792" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12797" href="Test.Golden.html#12783" class="Bound">acc</a>
  <a id="12803" href="Test.Golden.html#12734" class="Function">loop</a> <a id="12808" href="Test.Golden.html#12808" class="Bound">acc</a> <a id="12812" class="Symbol">(</a><a id="12813" href="Test.Golden.html#12813" class="Bound">test</a> <a id="12818" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12820" href="Test.Golden.html#12820" class="Bound">tests</a><a id="12825" class="Symbol">)</a> <a id="12827" class="Symbol">=</a> <a id="12829" class="Keyword">do</a>
    <a id="12836" href="Test.Golden.html#12836" class="Bound">res</a> <a id="12840" href="IO.Base.html#2084" class="Function Operator">&lt;-</a> <a id="12843" href="Test.Golden.html#7209" class="Function">runTest</a> <a id="12851" href="Test.Golden.html#12265" class="Bound">opts</a> <a id="12856" href="Test.Golden.html#12813" class="Bound">test</a>
    <a id="12865" href="Test.Golden.html#12734" class="Function">loop</a> <a id="12870" class="Symbol">(</a><a id="12871" href="Test.Golden.html#11733" class="Function">Summary.update</a> <a id="12886" class="Symbol">(</a><a id="12887" href="Test.Golden.html#12836" class="Bound">res</a> <a id="12891" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12893" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="12895" class="Symbol">)</a> <a id="12897" href="Test.Golden.html#12808" class="Bound">acc</a><a id="12900" class="Symbol">)</a> <a id="12902" href="Test.Golden.html#12820" class="Bound">tests</a>

<a id="runner"></a><a id="12909" href="Test.Golden.html#12909" class="Function">runner</a> <a id="12916" class="Symbol">:</a> <a id="12918" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12923" href="Test.Golden.html#11239" class="Record">TestPool</a> <a id="12932" class="Symbol">→</a> <a id="12934" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="12937" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
<a id="12939" href="Test.Golden.html#12909" class="Function">runner</a> <a id="12946" href="Test.Golden.html#12946" class="Bound">tests</a> <a id="12952" class="Symbol">=</a> <a id="12954" class="Keyword">do</a>
  <a id="12959" class="Comment">-- figure out the options</a>
  <a id="12987" href="Test.Golden.html#12987" class="Bound">args</a> <a id="12992" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="12994" href="System.Environment.html#655" class="Function">getArgs</a>
  <a id="13004" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="13009" href="Test.Golden.html#13009" class="Bound">opts</a> <a id="13014" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="13016" href="Test.Golden.html#5584" class="Function">options</a> <a id="13024" href="Test.Golden.html#12987" class="Bound">args</a>
    <a id="13033" class="Keyword">where</a> <a id="13039" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="13044" href="Test.Golden.html#13044" class="Bound">err</a> <a id="13048" class="Symbol">→</a> <a id="13050" href="System.Exit.html#1366" class="Function">die</a> <a id="13054" class="Symbol">(</a><a id="13055" href="Data.String.Base.html#2824" class="Function">unlines</a> <a id="13063" class="Symbol">(</a><a id="13064" href="Test.Golden.html#5397" class="Function">show</a> <a id="13069" href="Test.Golden.html#13044" class="Bound">err</a> <a id="13073" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13075" href="Test.Golden.html#5101" class="Function">usage</a> <a id="13081" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13083" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="13085" class="Symbol">))</a>

  <a id="13091" class="Comment">-- run the tests</a>
  <a id="13110" href="Test.Golden.html#13110" class="Bound">ress</a> <a id="13115" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="13117" href="IO.html#2045" class="Function">List.mapM</a> <a id="13127" class="Symbol">(</a><a id="13128" href="Test.Golden.html#12209" class="Function">poolRunner</a> <a id="13139" href="Test.Golden.html#13009" class="Bound">opts</a><a id="13143" class="Symbol">)</a> <a id="13145" href="Test.Golden.html#12946" class="Bound">tests</a>
  <a id="13153" class="Keyword">let</a> <a id="13157" class="Keyword">open</a> <a id="13162" href="Test.Golden.html#11365" class="Module">Summary</a>
  <a id="13172" class="Keyword">let</a> <a id="13176" href="Test.Golden.html#13176" class="Bound">res</a> <a id="13180" class="Symbol">=</a> <a id="13182" href="Data.List.Base.html#4421" class="Function">List.foldl</a> <a id="13193" href="Test.Golden.html#11605" class="Function">merge</a> <a id="13199" href="Test.Golden.html#11562" class="Function">init</a> <a id="13204" href="Test.Golden.html#13110" class="Bound">ress</a>

  <a id="13212" class="Comment">-- report the result</a>
  <a id="13235" class="Keyword">let</a> <a id="13239" href="Test.Golden.html#13239" class="Bound">nsucc</a> <a id="13245" class="Symbol">=</a> <a id="13247" href="Data.List.Base.html#5067" class="Function">List.length</a> <a id="13259" class="Symbol">(</a><a id="13260" href="Test.Golden.html#13176" class="Bound">res</a> <a id="13264" class="Symbol">.</a><a id="13265" href="Test.Golden.html#11487" class="Field">success</a><a id="13272" class="Symbol">)</a>
  <a id="13276" class="Keyword">let</a> <a id="13280" href="Test.Golden.html#13280" class="Bound">nfail</a> <a id="13286" class="Symbol">=</a> <a id="13288" href="Data.List.Base.html#5067" class="Function">List.length</a> <a id="13300" class="Symbol">(</a><a id="13301" href="Test.Golden.html#13176" class="Bound">res</a> <a id="13305" class="Symbol">.</a><a id="13306" href="Test.Golden.html#11515" class="Field">failure</a><a id="13313" class="Symbol">)</a>
  <a id="13317" class="Keyword">let</a> <a id="13321" href="Test.Golden.html#13321" class="Bound">ntotal</a> <a id="13328" class="Symbol">=</a> <a id="13330" href="Test.Golden.html#13239" class="Bound">nsucc</a> <a id="13336" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+</a> <a id="13338" href="Test.Golden.html#13280" class="Bound">nfail</a>
  <a id="13346" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13355" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13357" href="Data.String.Base.html#2611" class="Function">concat</a> <a id="13364" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13366" href="Data.Nat.Show.html#1933" class="Function">ℕ.show</a> <a id="13373" href="Test.Golden.html#13239" class="Bound">nsucc</a> <a id="13379" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13381" class="String">&quot;/&quot;</a> <a id="13385" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13387" href="Data.Nat.Show.html#1933" class="Function">ℕ.show</a> <a id="13394" href="Test.Golden.html#13321" class="Bound">ntotal</a> <a id="13401" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13403" class="String">&quot; tests successful&quot;</a> <a id="13423" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13425" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="13431" class="Comment">-- deal with failures</a>
  <a id="13455" class="Keyword">let</a> <a id="13459" href="Test.Golden.html#13459" class="Bound">list</a> <a id="13464" class="Symbol">=</a> <a id="13466" href="Data.String.Base.html#2824" class="Function">unlines</a> <a id="13474" class="Symbol">(</a><a id="13475" href="Test.Golden.html#13176" class="Bound">res</a> <a id="13479" class="Symbol">.</a><a id="13480" href="Test.Golden.html#11515" class="Field">failure</a><a id="13487" class="Symbol">)</a>
  <a id="13491" href="IO.Base.html#3334" class="Function">when</a> <a id="13496" class="Symbol">(</a><a id="13497" class="Number">0</a> <a id="13499" href="Data.Nat.Base.html#1310" class="Primitive Operator">&lt;ᵇ</a> <a id="13502" href="Test.Golden.html#13280" class="Bound">nfail</a><a id="13507" class="Symbol">)</a> <a id="13509" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13511" class="Keyword">do</a>
    <a id="13518" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13527" class="String">&quot;Failing tests:&quot;</a>
    <a id="13548" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13557" href="Test.Golden.html#13459" class="Bound">list</a>
  <a id="13564" href="IO.Base.html#3457" class="Function">whenJust</a> <a id="13573" class="Symbol">(</a><a id="13574" href="Test.Golden.html#13009" class="Bound">opts</a> <a id="13579" class="Symbol">.</a><a id="13580" href="Test.Golden.html#4774" class="Field">failureFile</a><a id="13591" class="Symbol">)</a> <a id="13593" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13595" class="Symbol">λ</a> <a id="13597" href="Test.Golden.html#13597" class="Bound">fp</a> <a id="13600" class="Symbol">→</a> <a id="13602" href="IO.Finite.html#1276" class="Function">writeFile</a> <a id="13612" href="Test.Golden.html#13597" class="Bound">fp</a> <a id="13615" href="Test.Golden.html#13459" class="Bound">list</a>

  <a id="13623" class="Comment">-- exit</a>
  <a id="13633" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="13636" class="Number">0</a> <a id="13638" href="Data.Nat.Base.html#1136" class="Primitive Operator">≡ᵇ</a> <a id="13641" href="Test.Golden.html#13280" class="Bound">nfail</a>
   <a id="13650" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="13655" href="System.Exit.html#1311" class="Function">exitSuccess</a>
   <a id="13670" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="13675" href="System.Exit.html#1248" class="Function">exitFailure</a>
</pre></body></html>