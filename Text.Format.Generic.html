<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Text.Format.Generic</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Format strings for Printf and Scanf</a>
<a id="145" class="Comment">------------------------------------------------------------------------</a>

<a id="219" class="Symbol">{-#</a> <a id="223" class="Keyword">OPTIONS</a> <a id="231" class="Pragma">--cubical-compatible</a> <a id="252" class="Pragma">--safe</a> <a id="259" class="Symbol">#-}</a>

<a id="264" class="Keyword">module</a> <a id="271" href="Text.Format.Generic.html" class="Module">Text.Format.Generic</a> <a id="291" class="Keyword">where</a>

<a id="298" class="Keyword">open</a> <a id="303" class="Keyword">import</a> <a id="310" href="Level.html" class="Module">Level</a> <a id="316" class="Keyword">using</a> <a id="322" class="Symbol">(</a><a id="323" href="Level.html#521" class="Function">0ℓ</a><a id="325" class="Symbol">)</a>
<a id="327" class="Keyword">open</a> <a id="332" class="Keyword">import</a> <a id="339" href="Effect.Applicative.html" class="Module">Effect.Applicative</a>
<a id="358" class="Keyword">open</a> <a id="363" class="Keyword">import</a> <a id="370" href="Data.Char.Base.html" class="Module">Data.Char.Base</a> <a id="385" class="Keyword">using</a> <a id="391" class="Symbol">(</a><a id="392" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a><a id="396" class="Symbol">)</a>
<a id="398" class="Keyword">open</a> <a id="403" class="Keyword">import</a> <a id="410" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="425" class="Symbol">as</a> <a id="428" class="Module">List</a>
<a id="433" class="Keyword">open</a> <a id="438" class="Keyword">import</a> <a id="445" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="461" class="Symbol">as</a> <a id="464" class="Module">Maybe</a>
<a id="470" class="Keyword">open</a> <a id="475" class="Keyword">import</a> <a id="482" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
<a id="496" class="Keyword">open</a> <a id="501" class="Keyword">import</a> <a id="508" href="Data.Product.html" class="Module">Data.Product</a>
<a id="521" class="Keyword">open</a> <a id="526" class="Keyword">import</a> <a id="533" href="Data.Product.Nary.NonDependent.html" class="Module">Data.Product.Nary.NonDependent</a>
<a id="564" class="Keyword">open</a> <a id="569" class="Keyword">import</a> <a id="576" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a>
<a id="590" class="Keyword">open</a> <a id="595" class="Keyword">import</a> <a id="602" href="Data.String.Base.html" class="Module">Data.String.Base</a>
<a id="619" class="Keyword">import</a> <a id="626" href="Data.Sum.Effectful.Left.html" class="Module">Data.Sum.Effectful.Left</a> <a id="650" class="Symbol">as</a> <a id="653" class="Module">Sumₗ</a>
<a id="658" class="Keyword">open</a> <a id="663" class="Keyword">import</a> <a id="670" href="Function.Base.html" class="Module">Function.Base</a>
<a id="684" class="Keyword">open</a> <a id="689" class="Keyword">import</a> <a id="696" href="Function.Nary.NonDependent.html" class="Module">Function.Nary.NonDependent</a> <a id="723" class="Keyword">using</a> <a id="729" class="Symbol">(</a><a id="730" href="Function.Nary.NonDependent.html#1540" class="Function">0ℓs</a><a id="733" class="Symbol">;</a> <a id="735" href="Function.Nary.NonDependent.Base.html#2339" class="Function">Sets</a><a id="739" class="Symbol">)</a>
<a id="741" class="Keyword">open</a> <a id="746" class="Keyword">import</a> <a id="753" href="Function.Strict.html" class="Module">Function.Strict</a>

<a id="770" class="Comment">------------------------------------------------------------------------</a>
<a id="843" class="Comment">-- Format specifications.</a>
<a id="869" class="Comment">-- Defines the supported %-codes.</a>

<a id="904" class="Keyword">record</a> <a id="FormatSpec"></a><a id="911" href="Text.Format.Generic.html#911" class="Record">FormatSpec</a> <a id="922" class="Symbol">:</a> <a id="924" href="Agda.Primitive.html#320" class="Primitive">Set₁</a> <a id="929" class="Keyword">where</a>
  <a id="937" class="Keyword">field</a>
    <a id="FormatSpec.ArgChunk"></a><a id="947" href="Text.Format.Generic.html#947" class="Field">ArgChunk</a> <a id="956" class="Symbol">:</a> <a id="958" href="Agda.Primitive.html#320" class="Primitive">Set</a>
    <a id="FormatSpec.ArgType"></a><a id="966" href="Text.Format.Generic.html#966" class="Field">ArgType</a>  <a id="975" class="Symbol">:</a> <a id="977" href="Text.Format.Generic.html#947" class="Field">ArgChunk</a> <a id="986" class="Symbol">→</a> <a id="988" href="Agda.Primitive.html#320" class="Primitive">Set</a>
    <a id="FormatSpec.lexArg"></a><a id="996" href="Text.Format.Generic.html#996" class="Field">lexArg</a>   <a id="1005" class="Symbol">:</a> <a id="1007" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="1012" class="Symbol">→</a> <a id="1014" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1020" href="Text.Format.Generic.html#947" class="Field">ArgChunk</a>

<a id="1030" class="Keyword">module</a> <a id="1037" href="Text.Format.Generic.html#1037" class="Module">_</a> <a id="1039" class="Keyword">where</a>
  <a id="1047" class="Keyword">open</a> <a id="1052" href="Text.Format.Generic.html#911" class="Module">FormatSpec</a>

  <a id="1066" class="Comment">-- Left-biased union of format specs.</a>
  <a id="1106" href="Text.Format.Generic.html#1106" class="Function">unionSpec</a> <a id="1116" class="Symbol">:</a> <a id="1118" href="Text.Format.Generic.html#911" class="Record">FormatSpec</a> <a id="1129" class="Symbol">→</a> <a id="1131" href="Text.Format.Generic.html#911" class="Record">FormatSpec</a> <a id="1142" class="Symbol">→</a> <a id="1144" href="Text.Format.Generic.html#911" class="Record">FormatSpec</a>
  <a id="1157" href="Text.Format.Generic.html#1106" class="Function">unionSpec</a> <a id="1167" href="Text.Format.Generic.html#1167" class="Bound">spec₁</a> <a id="1173" href="Text.Format.Generic.html#1173" class="Bound">spec₂</a> <a id="1179" class="Symbol">.</a><a id="1180" href="Text.Format.Generic.html#947" class="Field">ArgChunk</a>  <a id="1190" class="Symbol">=</a> <a id="1192" href="Text.Format.Generic.html#1167" class="Bound">spec₁</a> <a id="1198" class="Symbol">.</a><a id="1199" href="Text.Format.Generic.html#947" class="Field">ArgChunk</a> <a id="1208" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="1210" href="Text.Format.Generic.html#1173" class="Bound">spec₂</a> <a id="1216" class="Symbol">.</a><a id="1217" href="Text.Format.Generic.html#947" class="Field">ArgChunk</a>
  <a id="1228" href="Text.Format.Generic.html#1106" class="Function">unionSpec</a> <a id="1238" href="Text.Format.Generic.html#1238" class="Bound">spec₁</a> <a id="1244" href="Text.Format.Generic.html#1244" class="Bound">spec₂</a> <a id="1250" class="Symbol">.</a><a id="1251" href="Text.Format.Generic.html#966" class="Field">ArgType</a> <a id="1259" class="Symbol">(</a><a id="1260" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="1265" href="Text.Format.Generic.html#1265" class="Bound">a</a><a id="1266" class="Symbol">)</a> <a id="1268" class="Symbol">=</a> <a id="1270" href="Text.Format.Generic.html#1238" class="Bound">spec₁</a> <a id="1276" class="Symbol">.</a><a id="1277" href="Text.Format.Generic.html#966" class="Field">ArgType</a> <a id="1285" href="Text.Format.Generic.html#1265" class="Bound">a</a>
  <a id="1289" href="Text.Format.Generic.html#1106" class="Function">unionSpec</a> <a id="1299" href="Text.Format.Generic.html#1299" class="Bound">spec₁</a> <a id="1305" href="Text.Format.Generic.html#1305" class="Bound">spec₂</a> <a id="1311" class="Symbol">.</a><a id="1312" href="Text.Format.Generic.html#966" class="Field">ArgType</a> <a id="1320" class="Symbol">(</a><a id="1321" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="1326" href="Text.Format.Generic.html#1326" class="Bound">a</a><a id="1327" class="Symbol">)</a> <a id="1329" class="Symbol">=</a> <a id="1331" href="Text.Format.Generic.html#1305" class="Bound">spec₂</a> <a id="1337" class="Symbol">.</a><a id="1338" href="Text.Format.Generic.html#966" class="Field">ArgType</a> <a id="1346" href="Text.Format.Generic.html#1326" class="Bound">a</a>
  <a id="1350" href="Text.Format.Generic.html#1106" class="Function">unionSpec</a> <a id="1360" href="Text.Format.Generic.html#1360" class="Bound">spec₁</a> <a id="1366" href="Text.Format.Generic.html#1366" class="Bound">spec₂</a> <a id="1372" class="Symbol">.</a><a id="1373" href="Text.Format.Generic.html#996" class="Field">lexArg</a>  <a id="1381" href="Text.Format.Generic.html#1381" class="Bound">c</a> <a id="1383" class="Symbol">=</a>
    <a id="1389" href="Data.Maybe.Base.html#2044" class="Function">Maybe.map</a> <a id="1399" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="1404" class="Symbol">(</a><a id="1405" href="Text.Format.Generic.html#1360" class="Bound">spec₁</a> <a id="1411" class="Symbol">.</a><a id="1412" href="Text.Format.Generic.html#996" class="Field">lexArg</a> <a id="1419" href="Text.Format.Generic.html#1381" class="Bound">c</a><a id="1420" class="Symbol">)</a> <a id="1422" href="Data.Maybe.Base.html#2374" class="Function Operator">&lt;∣&gt;</a>
    <a id="1430" href="Data.Maybe.Base.html#2044" class="Function">Maybe.map</a> <a id="1440" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="1445" class="Symbol">(</a><a id="1446" href="Text.Format.Generic.html#1366" class="Bound">spec₂</a> <a id="1452" class="Symbol">.</a><a id="1453" href="Text.Format.Generic.html#996" class="Field">lexArg</a> <a id="1460" href="Text.Format.Generic.html#1381" class="Bound">c</a><a id="1461" class="Symbol">)</a>

<a id="1464" class="Keyword">module</a> <a id="Format"></a><a id="1471" href="Text.Format.Generic.html#1471" class="Module">Format</a> <a id="1478" class="Symbol">(</a><a id="1479" href="Text.Format.Generic.html#1479" class="Bound">spec</a> <a id="1484" class="Symbol">:</a> <a id="1486" href="Text.Format.Generic.html#911" class="Record">FormatSpec</a><a id="1496" class="Symbol">)</a> <a id="1498" class="Keyword">where</a>

  <a id="1507" class="Keyword">open</a> <a id="1512" href="Text.Format.Generic.html#911" class="Module">FormatSpec</a> <a id="1523" href="Text.Format.Generic.html#1479" class="Bound">spec</a>

  <a id="1531" class="Comment">------------------------------------------------------------------------</a>
  <a id="1606" class="Comment">-- Basic types</a>

  <a id="1624" class="Keyword">data</a> <a id="Format.Chunk"></a><a id="1629" href="Text.Format.Generic.html#1629" class="Datatype">Chunk</a> <a id="1635" class="Symbol">:</a> <a id="1637" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1641" class="Keyword">where</a>
    <a id="Format.Chunk.Arg"></a><a id="1651" href="Text.Format.Generic.html#1651" class="InductiveConstructor">Arg</a> <a id="1655" class="Symbol">:</a> <a id="1657" href="Text.Format.Generic.html#947" class="Field">ArgChunk</a> <a id="1666" class="Symbol">→</a> <a id="1668" href="Text.Format.Generic.html#1629" class="Datatype">Chunk</a>
    <a id="Format.Chunk.Raw"></a><a id="1678" href="Text.Format.Generic.html#1678" class="InductiveConstructor">Raw</a> <a id="1682" class="Symbol">:</a> <a id="1684" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="1691" class="Symbol">→</a> <a id="1693" href="Text.Format.Generic.html#1629" class="Datatype">Chunk</a>

  <a id="Format.Format"></a><a id="1702" href="Text.Format.Generic.html#1702" class="Function">Format</a> <a id="1709" class="Symbol">:</a> <a id="1711" href="Agda.Primitive.html#320" class="Primitive">Set</a>
  <a id="1717" href="Text.Format.Generic.html#1702" class="Function">Format</a> <a id="1724" class="Symbol">=</a> <a id="1726" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="1731" href="Text.Format.Generic.html#1629" class="Datatype">Chunk</a>

  <a id="1740" class="Comment">------------------------------------------------------------------------</a>
  <a id="1815" class="Comment">-- Semantics</a>

  <a id="Format.size"></a><a id="1831" href="Text.Format.Generic.html#1831" class="Function">size</a> <a id="1836" class="Symbol">:</a> <a id="1838" href="Text.Format.Generic.html#1702" class="Function">Format</a> <a id="1845" class="Symbol">→</a> <a id="1847" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
  <a id="1851" href="Text.Format.Generic.html#1831" class="Function">size</a> <a id="1856" class="Symbol">=</a> <a id="1858" href="Data.List.Base.html#4987" class="Function">List.sum</a> <a id="1867" href="Function.Base.html#3646" class="Function Operator">∘′</a> <a id="1870" href="Data.List.Base.html#1615" class="Function">List.map</a> <a id="1879" class="Symbol">λ</a> <a id="1881" class="Symbol">{</a> <a id="1883" class="Symbol">(</a><a id="1884" href="Text.Format.Generic.html#1678" class="InductiveConstructor">Raw</a> <a id="1888" class="Symbol">_)</a> <a id="1891" class="Symbol">→</a> <a id="1893" class="Number">0</a><a id="1894" class="Symbol">;</a> <a id="1896" class="CatchallClause Symbol">_</a> <a id="1898" class="Symbol">→</a> <a id="1900" class="Number">1</a> <a id="1902" class="Symbol">}</a>

  <a id="1907" class="Comment">-- Meaning of a format as a list of value types</a>

  <a id="Format.⟦_⟧"></a><a id="1958" href="Text.Format.Generic.html#1958" class="Function Operator">⟦_⟧</a> <a id="1962" class="Symbol">:</a> <a id="1964" class="Symbol">(</a><a id="1965" href="Text.Format.Generic.html#1965" class="Bound">fmt</a> <a id="1969" class="Symbol">:</a> <a id="1971" href="Text.Format.Generic.html#1702" class="Function">Format</a><a id="1977" class="Symbol">)</a> <a id="1979" class="Symbol">→</a> <a id="1981" href="Function.Nary.NonDependent.Base.html#2339" class="Function">Sets</a> <a id="1986" class="Symbol">(</a><a id="1987" href="Text.Format.Generic.html#1831" class="Function">size</a> <a id="1992" href="Text.Format.Generic.html#1965" class="Bound">fmt</a><a id="1995" class="Symbol">)</a> <a id="1997" href="Function.Nary.NonDependent.html#1540" class="Function">0ℓs</a>
  <a id="2003" href="Text.Format.Generic.html#1958" class="Function Operator">⟦</a> <a id="2005" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>          <a id="2017" href="Text.Format.Generic.html#1958" class="Function Operator">⟧</a> <a id="2019" class="Symbol">=</a> <a id="2021" class="Symbol">_</a>
  <a id="2025" href="Text.Format.Generic.html#1958" class="Function Operator">⟦</a> <a id="2027" href="Text.Format.Generic.html#1651" class="InductiveConstructor">Arg</a> <a id="2031" href="Text.Format.Generic.html#2031" class="Bound">a</a>  <a id="2034" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2036" href="Text.Format.Generic.html#2036" class="Bound">cs</a> <a id="2039" href="Text.Format.Generic.html#1958" class="Function Operator">⟧</a> <a id="2041" class="Symbol">=</a> <a id="2043" href="Text.Format.Generic.html#966" class="Field">ArgType</a> <a id="2051" href="Text.Format.Generic.html#2031" class="Bound">a</a> <a id="2053" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2055" href="Text.Format.Generic.html#1958" class="Function Operator">⟦</a> <a id="2057" href="Text.Format.Generic.html#2036" class="Bound">cs</a> <a id="2060" href="Text.Format.Generic.html#1958" class="Function Operator">⟧</a>
  <a id="2064" href="Text.Format.Generic.html#1958" class="Function Operator">⟦</a> <a id="2066" href="Text.Format.Generic.html#1678" class="InductiveConstructor">Raw</a> <a id="2070" class="Symbol">_</a>  <a id="2073" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2075" href="Text.Format.Generic.html#2075" class="Bound">cs</a> <a id="2078" href="Text.Format.Generic.html#1958" class="Function Operator">⟧</a> <a id="2080" class="Symbol">=</a>             <a id="2094" href="Text.Format.Generic.html#1958" class="Function Operator">⟦</a> <a id="2096" href="Text.Format.Generic.html#2075" class="Bound">cs</a> <a id="2099" href="Text.Format.Generic.html#1958" class="Function Operator">⟧</a>

  <a id="2104" class="Comment">------------------------------------------------------------------------</a>
  <a id="2179" class="Comment">-- Lexer: from Strings to Formats</a>

  <a id="2216" class="Comment">-- Lexing may fail. To have a useful error message, we defined the following</a>
  <a id="2295" class="Comment">-- enumerated type</a>

  <a id="2317" class="Keyword">data</a> <a id="Format.Error"></a><a id="2322" href="Text.Format.Generic.html#2322" class="Datatype">Error</a> <a id="2328" class="Symbol">:</a> <a id="2330" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2334" class="Keyword">where</a>
    <a id="Format.Error.UnexpectedEndOfString"></a><a id="2344" href="Text.Format.Generic.html#2344" class="InductiveConstructor">UnexpectedEndOfString</a> <a id="2366" class="Symbol">:</a> <a id="2368" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="2375" class="Symbol">→</a> <a id="2377" href="Text.Format.Generic.html#2322" class="Datatype">Error</a>
    <a id="2387" class="Comment">-- ^ expected a type declaration; found an empty string</a>
    <a id="Format.Error.InvalidType"></a><a id="2447" href="Text.Format.Generic.html#2447" class="InductiveConstructor">InvalidType</a> <a id="2459" class="Symbol">:</a> <a id="2461" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="2468" class="Symbol">→</a> <a id="2470" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="2475" class="Symbol">→</a> <a id="2477" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="2484" class="Symbol">→</a> <a id="2486" href="Text.Format.Generic.html#2322" class="Datatype">Error</a>
    <a id="2496" class="Comment">-- ^ invalid type declaration</a>
    <a id="2530" class="Comment">--   return a focus: prefix processed, character causing failure, rest</a>

  <a id="Format.lexer"></a><a id="2604" href="Text.Format.Generic.html#2604" class="Function">lexer</a> <a id="2610" class="Symbol">:</a> <a id="2612" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="2619" class="Symbol">→</a> <a id="2621" href="Text.Format.Generic.html#2322" class="Datatype">Error</a> <a id="2627" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="2629" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2634" href="Text.Format.Generic.html#1629" class="Datatype">Chunk</a>
  <a id="2642" href="Text.Format.Generic.html#2604" class="Function">lexer</a> <a id="2648" href="Text.Format.Generic.html#2648" class="Bound">input</a> <a id="2654" class="Symbol">=</a> <a id="2656" href="Text.Format.Generic.html#3199" class="Function">loop</a> <a id="2661" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="2664" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="2667" class="Symbol">(</a><a id="2668" href="Data.String.Base.html#1550" class="Primitive">toList</a> <a id="2675" href="Text.Format.Generic.html#2648" class="Bound">input</a><a id="2680" class="Symbol">)</a> <a id="2682" class="Keyword">where</a>

    <a id="2693" class="Keyword">open</a> <a id="2698" href="Effect.Applicative.html#979" class="Module">RawApplicative</a> <a id="2713" class="Symbol">(</a><a id="2714" href="Data.Sum.Effectful.Left.html#963" class="Function">Sumₗ.applicative</a> <a id="2731" href="Text.Format.Generic.html#2322" class="Datatype">Error</a> <a id="2737" href="Level.html#521" class="Function">0ℓ</a><a id="2739" class="Symbol">)</a>

    <a id="2746" class="Comment">-- Type synonyms used locally to document the code</a>
    <a id="2801" href="Text.Format.Generic.html#2801" class="Function">RevWord</a> <a id="2809" class="Symbol">=</a> <a id="2811" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2816" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="2821" class="Comment">-- Mere characters accumulated so far</a>
    <a id="2863" href="Text.Format.Generic.html#2863" class="Function">Prefix</a>  <a id="2871" class="Symbol">=</a> <a id="2873" href="Text.Format.Generic.html#2801" class="Function">RevWord</a>   <a id="2883" class="Comment">-- Prefix of the input String already read</a>

    <a id="2931" href="Text.Format.Generic.html#2931" class="Function">toRevString</a> <a id="2943" class="Symbol">:</a> <a id="2945" href="Text.Format.Generic.html#2801" class="Function">RevWord</a> <a id="2953" class="Symbol">→</a> <a id="2955" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="2966" href="Text.Format.Generic.html#2931" class="Function">toRevString</a> <a id="2978" class="Symbol">=</a> <a id="2980" href="Data.String.Base.html#1583" class="Primitive">fromList</a> <a id="2989" href="Function.Base.html#3646" class="Function Operator">∘′</a> <a id="2992" href="Data.List.Base.html#6996" class="Function">reverse</a>

    <a id="3005" class="Comment">-- Push a Raw token if we have accumulated some mere characters</a>
    <a id="3073" href="Text.Format.Generic.html#3073" class="Function">push</a> <a id="3078" class="Symbol">:</a> <a id="3080" href="Text.Format.Generic.html#2801" class="Function">RevWord</a> <a id="3088" class="Symbol">→</a> <a id="3090" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3095" href="Text.Format.Generic.html#1629" class="Datatype">Chunk</a> <a id="3101" class="Symbol">→</a> <a id="3103" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3108" href="Text.Format.Generic.html#1629" class="Datatype">Chunk</a>
    <a id="3118" href="Text.Format.Generic.html#3073" class="Function">push</a> <a id="3123" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="3126" href="Text.Format.Generic.html#3126" class="Bound">ks</a> <a id="3129" class="Symbol">=</a> <a id="3131" href="Text.Format.Generic.html#3126" class="Bound">ks</a>
    <a id="3138" href="Text.Format.Generic.html#3073" class="CatchallClause Function">push</a><a id="3142" class="CatchallClause"> </a><a id="3143" href="Text.Format.Generic.html#3143" class="CatchallClause Bound">cs</a><a id="3145" class="CatchallClause"> </a><a id="3146" href="Text.Format.Generic.html#3146" class="CatchallClause Bound">ks</a> <a id="3149" class="Symbol">=</a> <a id="3151" href="Text.Format.Generic.html#1678" class="InductiveConstructor">Raw</a> <a id="3155" class="Symbol">(</a><a id="3156" href="Text.Format.Generic.html#2931" class="Function">toRevString</a> <a id="3168" href="Text.Format.Generic.html#3143" class="Bound">cs</a><a id="3170" class="Symbol">)</a> <a id="3172" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3174" href="Text.Format.Generic.html#3146" class="Bound">ks</a>

    <a id="3182" class="Comment">-- Main loop</a>
    <a id="3199" href="Text.Format.Generic.html#3199" class="Function">loop</a> <a id="3204" class="Symbol">:</a> <a id="3206" href="Text.Format.Generic.html#2801" class="Function">RevWord</a> <a id="3214" class="Symbol">→</a> <a id="3216" href="Text.Format.Generic.html#2863" class="Function">Prefix</a> <a id="3223" class="Symbol">→</a> <a id="3225" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3230" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="3235" class="Symbol">→</a> <a id="3237" href="Text.Format.Generic.html#2322" class="Datatype">Error</a> <a id="3243" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="3245" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3250" href="Text.Format.Generic.html#1629" class="Datatype">Chunk</a>
    <a id="3260" href="Text.Format.Generic.html#3260" class="Function">type</a> <a id="3265" class="Symbol">:</a>           <a id="3277" href="Text.Format.Generic.html#2863" class="Function">Prefix</a> <a id="3284" class="Symbol">→</a> <a id="3286" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3291" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="3296" class="Symbol">→</a> <a id="3298" href="Text.Format.Generic.html#2322" class="Datatype">Error</a> <a id="3304" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="3306" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="3311" href="Text.Format.Generic.html#1629" class="Datatype">Chunk</a>

    <a id="3322" href="Text.Format.Generic.html#3199" class="Function">loop</a> <a id="3327" href="Text.Format.Generic.html#3327" class="Bound">acc</a> <a id="3331" href="Text.Format.Generic.html#3331" class="Bound">bef</a> <a id="3335" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>               <a id="3352" class="Symbol">=</a> <a id="3354" href="Effect.Applicative.html#1147" class="Function">pure</a> <a id="3359" class="Symbol">(</a><a id="3360" href="Text.Format.Generic.html#3073" class="Function">push</a> <a id="3365" href="Text.Format.Generic.html#3327" class="Bound">acc</a> <a id="3369" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3371" class="Symbol">)</a>
    <a id="3377" class="Comment">-- escaped &#39;%&#39; character: treat like a mere character</a>
    <a id="3435" href="Text.Format.Generic.html#3199" class="Function">loop</a> <a id="3440" href="Text.Format.Generic.html#3440" class="Bound">acc</a> <a id="3444" href="Text.Format.Generic.html#3444" class="Bound">bef</a> <a id="3448" class="Symbol">(</a><a id="3449" class="String">&#39;%&#39;</a> <a id="3453" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3455" class="String">&#39;%&#39;</a> <a id="3459" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3461" href="Text.Format.Generic.html#3461" class="Bound">cs</a><a id="3463" class="Symbol">)</a> <a id="3465" class="Symbol">=</a> <a id="3467" href="Text.Format.Generic.html#3199" class="Function">loop</a> <a id="3472" class="Symbol">(</a><a id="3473" class="String">&#39;%&#39;</a> <a id="3477" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3479" href="Text.Format.Generic.html#3440" class="Bound">acc</a><a id="3482" class="Symbol">)</a> <a id="3484" class="Symbol">(</a><a id="3485" class="String">&#39;%&#39;</a> <a id="3489" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3491" class="String">&#39;%&#39;</a> <a id="3495" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3497" href="Text.Format.Generic.html#3444" class="Bound">bef</a><a id="3500" class="Symbol">)</a> <a id="3502" href="Text.Format.Generic.html#3461" class="Bound">cs</a>
    <a id="3509" class="Comment">-- non escaped &#39;%&#39;: type declaration following</a>
    <a id="3560" href="Text.Format.Generic.html#3199" class="CatchallClause Function">loop</a><a id="3564" class="CatchallClause"> </a><a id="3565" href="Text.Format.Generic.html#3565" class="CatchallClause Bound">acc</a><a id="3568" class="CatchallClause"> </a><a id="3569" href="Text.Format.Generic.html#3569" class="CatchallClause Bound">bef</a><a id="3572" class="CatchallClause"> </a><a id="3573" class="CatchallClause Symbol">(</a><a id="3574" class="CatchallClause String">&#39;%&#39;</a><a id="3577" class="CatchallClause"> </a><a id="3578" href="Agda.Builtin.List.html#182" class="CatchallClause InductiveConstructor Operator">∷</a><a id="3579" class="CatchallClause"> </a><a id="3580" href="Text.Format.Generic.html#3580" class="CatchallClause Bound">cs</a><a id="3582" class="CatchallClause Symbol">)</a>       <a id="3590" class="Symbol">=</a> <a id="3592" href="Text.Format.Generic.html#3073" class="Function">push</a> <a id="3597" href="Text.Format.Generic.html#3565" class="Bound">acc</a> <a id="3601" href="Effect.Functor.html#687" class="Function Operator">&lt;$&gt;</a> <a id="3605" href="Text.Format.Generic.html#3260" class="Function">type</a> <a id="3610" class="Symbol">(</a><a id="3611" class="String">&#39;%&#39;</a> <a id="3615" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3617" href="Text.Format.Generic.html#3569" class="Bound">bef</a><a id="3620" class="Symbol">)</a> <a id="3622" href="Text.Format.Generic.html#3580" class="Bound">cs</a>
    <a id="3629" class="Comment">-- mere character: push onto the accumulator</a>
    <a id="3678" href="Text.Format.Generic.html#3199" class="Function">loop</a> <a id="3683" href="Text.Format.Generic.html#3683" class="Bound">acc</a> <a id="3687" href="Text.Format.Generic.html#3687" class="Bound">bef</a> <a id="3691" class="Symbol">(</a><a id="3692" href="Text.Format.Generic.html#3692" class="Bound">c</a> <a id="3694" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3696" href="Text.Format.Generic.html#3696" class="Bound">cs</a><a id="3698" class="Symbol">)</a>         <a id="3708" class="Symbol">=</a> <a id="3710" href="Text.Format.Generic.html#3199" class="Function">loop</a> <a id="3715" class="Symbol">(</a><a id="3716" href="Text.Format.Generic.html#3692" class="Bound">c</a> <a id="3718" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3720" href="Text.Format.Generic.html#3683" class="Bound">acc</a><a id="3723" class="Symbol">)</a> <a id="3725" class="Symbol">(</a><a id="3726" href="Text.Format.Generic.html#3692" class="Bound">c</a> <a id="3728" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3730" href="Text.Format.Generic.html#3687" class="Bound">bef</a><a id="3733" class="Symbol">)</a> <a id="3735" href="Text.Format.Generic.html#3696" class="Bound">cs</a>

    <a id="3743" href="Text.Format.Generic.html#3260" class="Function">type</a> <a id="3748" href="Text.Format.Generic.html#3748" class="Bound">bef</a> <a id="3752" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>       <a id="3761" class="Symbol">=</a> <a id="3763" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="3768" class="Symbol">(</a><a id="3769" href="Text.Format.Generic.html#2344" class="InductiveConstructor">UnexpectedEndOfString</a> <a id="3791" href="Text.Format.Generic.html#2648" class="Bound">input</a><a id="3796" class="Symbol">)</a>
    <a id="3802" href="Text.Format.Generic.html#3260" class="Function">type</a> <a id="3807" href="Text.Format.Generic.html#3807" class="Bound">bef</a> <a id="3811" class="Symbol">(</a><a id="3812" href="Text.Format.Generic.html#3812" class="Bound">c</a> <a id="3814" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3816" href="Text.Format.Generic.html#3816" class="Bound">cs</a><a id="3818" class="Symbol">)</a> <a id="3820" class="Symbol">=</a> <a id="3822" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">_∷_</a> <a id="3826" href="Effect.Functor.html#687" class="Function Operator">&lt;$&gt;</a> <a id="3830" href="Text.Format.Generic.html#3874" class="Function">chunk</a> <a id="3836" href="Text.Format.Generic.html#3812" class="Bound">c</a> <a id="3838" href="Effect.Applicative.html#1524" class="Function Operator">⊛</a> <a id="3840" href="Text.Format.Generic.html#3199" class="Function">loop</a> <a id="3845" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="3848" class="Symbol">(</a><a id="3849" href="Text.Format.Generic.html#3812" class="Bound">c</a> <a id="3851" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3853" href="Text.Format.Generic.html#3807" class="Bound">bef</a><a id="3856" class="Symbol">)</a> <a id="3858" href="Text.Format.Generic.html#3816" class="Bound">cs</a> <a id="3861" class="Keyword">where</a>

      <a id="3874" href="Text.Format.Generic.html#3874" class="Function">chunk</a> <a id="3880" class="Symbol">:</a> <a id="3882" href="Agda.Builtin.Char.html#221" class="Postulate">Char</a> <a id="3887" class="Symbol">→</a> <a id="3889" href="Text.Format.Generic.html#2322" class="Datatype">Error</a> <a id="3895" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="3897" href="Text.Format.Generic.html#1629" class="Datatype">Chunk</a>
      <a id="3909" href="Text.Format.Generic.html#3874" class="Function">chunk</a> <a id="3915" href="Text.Format.Generic.html#3915" class="Bound">c</a> <a id="3917" class="Symbol">=</a>
        <a id="3927" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="3932" href="Text.Format.Generic.html#996" class="Field">lexArg</a> <a id="3939" href="Text.Format.Generic.html#3915" class="Bound">c</a> <a id="3941" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="3944" class="Symbol">λ</a> <a id="3946" class="Keyword">where</a>
          <a id="3962" class="Symbol">(</a><a id="3963" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3968" href="Text.Format.Generic.html#3968" class="Bound">ch</a><a id="3970" class="Symbol">)</a> <a id="3972" class="Symbol">→</a> <a id="3974" href="Effect.Applicative.html#1147" class="Function">pure</a> <a id="3979" class="Symbol">(</a><a id="3980" href="Text.Format.Generic.html#1651" class="InductiveConstructor">Arg</a> <a id="3984" href="Text.Format.Generic.html#3968" class="Bound">ch</a><a id="3986" class="Symbol">)</a>
          <a id="3998" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>   <a id="4008" class="Symbol">→</a>
            <a id="4022" href="Function.Strict.html#1672" class="Function">force′</a> <a id="4029" class="Symbol">(</a><a id="4030" href="Text.Format.Generic.html#2931" class="Function">toRevString</a> <a id="4042" href="Text.Format.Generic.html#3807" class="Bound">bef</a><a id="4045" class="Symbol">)</a> <a id="4047" class="Symbol">λ</a> <a id="4049" href="Text.Format.Generic.html#4049" class="Bound">prefix</a> <a id="4056" class="Symbol">→</a>
            <a id="4070" href="Function.Strict.html#1672" class="Function">force′</a> <a id="4077" class="Symbol">(</a><a id="4078" href="Data.String.Base.html#1583" class="Primitive">fromList</a> <a id="4087" href="Text.Format.Generic.html#3816" class="Bound">cs</a><a id="4089" class="Symbol">)</a>     <a id="4095" class="Symbol">λ</a> <a id="4097" href="Text.Format.Generic.html#4097" class="Bound">suffix</a> <a id="4104" class="Symbol">→</a>
            <a id="4118" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="4123" class="Symbol">(</a><a id="4124" href="Text.Format.Generic.html#2447" class="InductiveConstructor">InvalidType</a> <a id="4136" href="Text.Format.Generic.html#4049" class="Bound">prefix</a> <a id="4143" href="Text.Format.Generic.html#3915" class="Bound">c</a> <a id="4145" href="Text.Format.Generic.html#4097" class="Bound">suffix</a><a id="4151" class="Symbol">)</a>
</pre></body></html>